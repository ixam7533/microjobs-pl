"use strict";(()=>{var e={};e.id=6651,e.ids=[6651],e.modules={3524:e=>{e.exports=require("@prisma/client")},4802:e=>{e.exports=require("cookie")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7621:(e,r,i)=>{i.r(r),i.d(r,{config:()=>l,default:()=>c,routeModule:()=>p});var n={};i.r(n),i.d(n,{default:()=>handler});var s=i(1802),t=i(7153),o=i(6249),a=i(298),d=i(4802),u=i(5066);async function handler(e,r){if("GET"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let i=(0,d.parse)(e.headers.cookie||""),n=i.token;if(!n)return r.status(401).json({error:"Token required"});let s=(0,a.W)(n);if(!s||!s.id)return r.status(401).json({error:"Invalid token"});let t=await u.Z.user.findUnique({where:{id:parseInt(s.id)}}),o=t?.isAdmin||t?.email==="microjobsj7@gmail.com";if(!o)return r.status(403).json({error:"Admin access required"});let c=await u.Z.user.findMany({select:{id:!0,email:!0,name:!0,subscriptionType:!0,subscriptionStart:!0,subscriptionEnd:!0,promotionsUsed:!0,createdAt:!0,isAdmin:!0},orderBy:{createdAt:"desc"}}),l=c.map(e=>({...e,isSubscriptionActive:"FREE"!==e.subscriptionType&&(!e.subscriptionEnd||e.subscriptionEnd>new Date),daysRemaining:e.subscriptionEnd?Math.max(0,Math.ceil((e.subscriptionEnd.getTime()-new Date().getTime())/864e5)):null}));r.status(200).json({users:l})}catch(e){console.error("Admin users list error:",e),r.status(500).json({error:"Internal server error"})}}let c=(0,o.l)(n,"default"),l=(0,o.l)(n,"config"),p=new s.PagesAPIRouteModule({definition:{kind:t.x.PAGES_API,page:"/api/admin/users",pathname:"/api/admin/users",bundlePath:"",filename:""},userland:n})},298:(e,r,i)=>{i.d(r,{W:()=>verifyToken,f:()=>signToken});var n=i(9344),s=i.n(n);let t=process.env.JWT_SECRET;if(!t)throw Error("JWT_SECRET is missing in environment variables");function signToken(e,r="7d"){let i={expiresIn:String(r)};return s().sign(e,t,i)}function verifyToken(e){return s().verify(e,t)}},5066:(e,r,i)=>{i.d(r,{Z:()=>t});var n=i(3524);let s=new n.PrismaClient,t=s}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),i=r.X(0,[4222],()=>__webpack_exec__(7621));module.exports=i})();