exports.id=2682,exports.ids=[2682],exports.modules={9470:e=>{e.exports={modalOverlay:"OfferModal_modalOverlay__zOASt",bgContainer:"OfferModal_bgContainer__1xH_L",bgVideo:"OfferModal_bgVideo__lb17Q",nightBackground:"OfferModal_nightBackground__2Kcd0",naturaBackground:"OfferModal_naturaBackground__VVe_V",bgTint:"OfferModal_bgTint__9j4kX",modalContent:"OfferModal_modalContent__kVKRB",modalAppear:"OfferModal_modalAppear__eskWo",closeBtn:"OfferModal_closeBtn__xcikq",imagesSection:"OfferModal_imagesSection__gnvI_",mainImageContainer:"OfferModal_mainImageContainer__iespG",mainImage:"OfferModal_mainImage__WSege",imageOverlay:"OfferModal_imageOverlay__VRhd7",thumbnails:"OfferModal_thumbnails__gNeXR",thumbnail:"OfferModal_thumbnail__dAze7",activeThumbnail:"OfferModal_activeThumbnail__8lxLu",imageNavigation:"OfferModal_imageNavigation__O6mUb",prevBtn:"OfferModal_prevBtn__Q1Ohx",nextBtn:"OfferModal_nextBtn__AHfPe",imageIndicator:"OfferModal_imageIndicator__0vFGh",contentSection:"OfferModal_contentSection__WN0Cc",titleSection:"OfferModal_titleSection__KpDwo",title:"OfferModal_title__UkYDo",priceTag:"OfferModal_priceTag__VZeCI",shimmer:"OfferModal_shimmer__vZguw",price:"OfferModal_price__XqApu",metaInfo:"OfferModal_metaInfo__qoqmk",metaItem:"OfferModal_metaItem__X8H4j",metaIcon:"OfferModal_metaIcon__u4f8t",metaContent:"OfferModal_metaContent__hHcMY",metaLabel:"OfferModal_metaLabel__UP3Q_",metaValue:"OfferModal_metaValue__qXrrM",sectionTitle:"OfferModal_sectionTitle__k7MOY",descriptionSection:"OfferModal_descriptionSection__kR1i2",description:"OfferModal_description__iFXs4",contactSection:"OfferModal_contactSection__OS9gi",contactGrid:"OfferModal_contactGrid__U8xZk",contactItem:"OfferModal_contactItem__pj_Ww",contactIcon:"OfferModal_contactIcon__dCo_6",contactContent:"OfferModal_contactContent__DHoIF",contactLabel:"OfferModal_contactLabel__XS5HV",contactValue:"OfferModal_contactValue__J0vRx",actionSection:"OfferModal_actionSection__TFDXg",primaryBtn:"OfferModal_primaryBtn__35fBX",secondaryBtn:"OfferModal_secondaryBtn__tI2OI",ratingBtn:"OfferModal_ratingBtn__gplVr",btnIcon:"OfferModal_btnIcon__GFNP8",starGlow:"OfferModal_starGlow__tkKai",promoteBtn:"OfferModal_promoteBtn__DiN0H",loadingSpinner:"OfferModal_loadingSpinner__w6UrO",spin:"OfferModal_spin__P_C6B",keyboardHints:"OfferModal_keyboardHints__fZ5t_",clickableUser:"OfferModal_clickableUser__kewUz",viewProfileHint:"OfferModal_viewProfileHint__0Yak_",pulse:"OfferModal_pulse__DqkM0",ratingSuccess:"OfferModal_ratingSuccess__IsKii",checkmarkBounce:"OfferModal_checkmarkBounce__N5z5u",adSection:"OfferModal_adSection__axsld"}},9093:e=>{e.exports={modalOverlay:"RatingModal_modalOverlay__YThcA",modalContent:"RatingModal_modalContent__2nqJL",modalSlideIn:"RatingModal_modalSlideIn__LJVkL",modalHeader:"RatingModal_modalHeader__KN8mK",closeButton:"RatingModal_closeButton__Jv1O3",modalBody:"RatingModal_modalBody__3SVaA",userInfo:"RatingModal_userInfo__OpyjA",offerTitle:"RatingModal_offerTitle__VaVMY",ratingSection:"RatingModal_ratingSection__etugJ",starsContainer:"RatingModal_starsContainer__AKK_s",star:"RatingModal_star__A4d4y",filled:"RatingModal_filled__JubPp",ratingText:"RatingModal_ratingText__S1oQS",commentSection:"RatingModal_commentSection__3ywTA",charCount:"RatingModal_charCount__RxPVr",modalFooter:"RatingModal_modalFooter__nPbL0",cancelButton:"RatingModal_cancelButton__EXSFm",submitButton:"RatingModal_submitButton__D6yr7"}},2682:(e,a,t)=>{"use strict";t.d(a,{Z:()=>OfferModal});var n=t(997),o=t(6689),l=t(9470),i=t.n(l),s=t(9093),c=t.n(s);function RatingModal({isOpen:e,onClose:a,userEmail:t,userName:l,offerId:i,offerTitle:s,onRatingAdded:r}){let[d,m]=(0,o.useState)(0),[_,u]=(0,o.useState)(0),[f,h]=(0,o.useState)(""),[g,p]=(0,o.useState)(!1),handleSubmit=async e=>{if(e.preventDefault(),0!==d){p(!0);try{let e=await fetch("/api/ratings/add",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reviewedEmail:t,rating:d,comment:f,offerId:i})});if(e.ok)r(),a(),m(0),h("");else{let a=await e.json();alert(a.message||"Błąd podczas dodawania oceny")}}catch(e){console.error("Error adding rating:",e),alert("Błąd podczas dodawania oceny")}finally{p(!1)}}};return e?n.jsx("div",{className:c().modalOverlay,onClick:a,children:(0,n.jsxs)("div",{className:c().modalContent,onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:c().modalHeader,children:[n.jsx("h2",{children:"Oceń użytkownika"}),n.jsx("button",{className:c().closeButton,onClick:a,children:"\xd7"})]}),(0,n.jsxs)("div",{className:c().modalBody,children:[(0,n.jsxs)("div",{className:c().userInfo,children:[n.jsx("h3",{children:l}),s&&(0,n.jsxs)("p",{className:c().offerTitle,children:["Za: ",s]})]}),(0,n.jsxs)("form",{onSubmit:handleSubmit,children:[(0,n.jsxs)("div",{className:c().ratingSection,children:[n.jsx("label",{children:"Twoja ocena:"}),n.jsx("div",{className:c().starsContainer,children:(()=>{let e=[];for(let a=1;a<=5;a++)e.push(n.jsx("button",{type:"button",className:`${c().star} ${a<=(_||d)?c().filled:""}`,onClick:()=>m(a),onMouseEnter:()=>u(a),onMouseLeave:()=>u(0),children:"⭐"},a));return e})()}),n.jsx("span",{className:c().ratingText,children:0===d?"Wybierz ocenę":`${d} ${1===d?"gwiazdka":d<5?"gwiazdki":"gwiazdek"}`})]}),(0,n.jsxs)("div",{className:c().commentSection,children:[n.jsx("label",{htmlFor:"comment",children:"Komentarz (opcjonalnie):"}),n.jsx("textarea",{id:"comment",value:f,onChange:e=>h(e.target.value),placeholder:"Opisz swoje doświadczenie...",rows:4,maxLength:500}),(0,n.jsxs)("div",{className:c().charCount,children:[f.length,"/500"]})]}),(0,n.jsxs)("div",{className:c().modalFooter,children:[n.jsx("button",{type:"button",onClick:a,className:c().cancelButton,children:"Anuluj"}),n.jsx("button",{type:"submit",disabled:0===d||g,className:c().submitButton,children:g?"Dodawanie...":"Dodaj ocenę"})]})]})]})]})}):null}function OfferModal({offer:e,isOpen:a,onClose:t}){let[l,s]=(0,o.useState)(0),[c,r]=(0,o.useState)(!1),[d,m]=(0,o.useState)(null),[_,u]=(0,o.useState)(null),[f,h]=(0,o.useState)("natura"),[g,p]=(0,o.useState)(!1),[j,x]=(0,o.useState)(null),[N,v]=(0,o.useState)(!1),[y,O]=(0,o.useState)(!1);(0,o.useEffect)(()=>{console.log("\uD83D\uDD0D OfferModal: Sprawdzam aktualnego użytkownika..."),fetch("/api/auth/me").then(e=>(console.log("\uD83D\uDCE5 /api/auth/me response status:",e.status),e.json())).then(e=>{console.log("\uD83D\uDC64 API /api/auth/me response:",e),e.user?(x(e.user),console.log("✅ Użytkownik zalogowany:",e.user.email),checkIfAlreadyRated(e.user.email)):console.log("❌ Użytkownik nie zalogowany")}).catch(e=>{console.error("\uD83D\uDCA5 Error fetching user:",e)})},[]);let checkIfAlreadyRated=async a=>{try{let a=await fetch(`/api/ratings/check?reviewedEmail=${e.contactEmail}&offerId=${e.id}`,{credentials:"include"});if(a.ok){let e=await a.json();O(e.hasRated)}}catch(e){console.error("Error checking rating:",e)}};if((0,o.useEffect)(()=>{let e=new MutationObserver(()=>{let e=document.documentElement.getAttribute("data-theme")||"natura";h(e)});e.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]});let a=document.documentElement.getAttribute("data-theme")||"natura";return h(a),()=>e.disconnect()},[]),(0,o.useEffect)(()=>{if(a){document.body.style.overflow="hidden",window.scrollTo({top:0,behavior:"smooth"});let handleKeyPress=e=>{"ArrowLeft"===e.key?prevImage():"ArrowRight"===e.key?nextImage():"Escape"===e.key&&t()};return document.addEventListener("keydown",handleKeyPress),()=>{document.removeEventListener("keydown",handleKeyPress)}}return document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}},[a]),!a||!e)return null;let b=e.images?.length?e.images:[e.image||"/house4k.jpg"],nextImage=()=>{r(!0),setTimeout(()=>{s(e=>(e+1)%b.length),r(!1)},200)},prevImage=()=>{r(!0),setTimeout(()=>{s(e=>(e-1+b.length)%b.length),r(!1)},200)},handleChatStart=async()=>{try{let a=await fetch("/api/auth/chats/new",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({withEmail:e.ownerEmail||e.contactEmail,offerId:e.id})});if(a.ok){let t=await a.json();console.log("✅ Chat utworzony:",t);try{let a=JSON.parse(localStorage.getItem("chatOfferMap")||"{}");a[t.chatId]=e.id,localStorage.setItem("chatOfferMap",JSON.stringify(a)),console.log("\uD83D\uDCBE Saved chat-offer mapping:",{chatId:t.chatId,offerId:e.id})}catch(e){console.error("⚠️ Failed to save chat-offer mapping:",e)}window.location.href=`/profile?tab=chat&chatId=${t.chatId}&offerId=${e.id}`}else{let e=await a.json();console.log("❌ Błąd API:",e),alert(e.error||"Błąd podczas rozpoczynania chatu")}}catch(e){console.error("\uD83D\uDCA5 Wyjątek podczas tworzenia czatu:",e),alert("Błąd podczas rozpoczynania chatu")}},handlePromoteOffer=async()=>{v(!0);try{let a=await fetch("/api/offers/promote",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({offerId:e.id})});if(a.ok){let e=await a.json();alert(`Oferta została promowana pomyślnie! Pozostało promowań: ${e.promotionsRemaining}`),t()}else{let e=await a.json();alert(e.error||"Błąd podczas promowania oferty")}}catch(e){console.error("Error promoting offer:",e),alert("Błąd podczas promowania oferty")}finally{v(!1)}};return(0,n.jsxs)("div",{className:i().modalOverlay,onClick:e=>{let a=e.target;a.closest("header")||a.closest('[data-header="true"]')||e.target!==e.currentTarget||t()},children:[(0,n.jsxs)("div",{className:i().bgContainer,children:[(()=>{switch(f){case"light":return n.jsx("video",{className:i().bgVideo,src:"/chmury.mp4",autoPlay:!0,loop:!0,muted:!0,playsInline:!0});case"dark":return n.jsx("video",{className:i().bgVideo,src:"/smoke.mp4",autoPlay:!0,loop:!0,muted:!0,playsInline:!0});case"night":return n.jsx("div",{className:i().nightBackground});default:return n.jsx("div",{className:i().naturaBackground})}})(),n.jsx("div",{className:i().bgTint})]}),(0,n.jsxs)("div",{className:i().modalContent,onClick:e=>{e.stopPropagation()},children:[n.jsx("button",{className:i().closeBtn,onClick:t,children:n.jsx("span",{children:"\xd7"})}),(0,n.jsxs)("div",{className:i().imagesSection,children:[(0,n.jsxs)("div",{className:i().mainImageContainer,children:[c&&n.jsx("div",{className:i().loadingSpinner}),n.jsx("img",{src:b[l],alt:`Zdjęcie ${l+1}`,className:i().mainImage,style:{opacity:c?.7:1},onTouchStart:e=>{u(null),m(e.targetTouches[0].clientX)},onTouchMove:e=>{u(e.targetTouches[0].clientX)},onTouchEnd:()=>{if(!d||!_)return;let e=d-_;e>50&&b.length>1&&nextImage(),e<-50&&b.length>1&&prevImage()}}),n.jsx("div",{className:i().imageOverlay}),b.length>1&&(0,n.jsxs)("div",{className:i().imageIndicator,children:[l+1," / ",b.length]}),b.length>1&&n.jsx("div",{className:i().keyboardHints,children:"← → lub kliknij aby przewijać"}),b.length>1&&(0,n.jsxs)(n.Fragment,{children:[n.jsx("button",{className:`${i().imageNavigation} ${i().prevBtn}`,onClick:prevImage,"aria-label":"Poprzednie zdjęcie",disabled:c,children:"←"}),n.jsx("button",{className:`${i().imageNavigation} ${i().nextBtn}`,onClick:nextImage,"aria-label":"Następne zdjęcie",disabled:c,children:"→"})]})]}),b.length>1&&n.jsx("div",{className:i().thumbnails,children:b.map((e,a)=>n.jsx("img",{src:e,alt:`Miniatura ${a+1}`,className:`${i().thumbnail} ${a===l?i().activeThumbnail:""}`,onClick:()=>{r(!0),setTimeout(()=>{s(a),r(!1)},150)}},a))})]}),(0,n.jsxs)("div",{className:i().contentSection,children:[(0,n.jsxs)("div",{className:i().titleSection,children:[n.jsx("h1",{className:i().title,children:e.title}),n.jsx("div",{className:i().priceTag,children:(0,n.jsxs)("span",{className:i().price,children:[e.price||100," zł"]})})]}),(0,n.jsxs)("div",{className:i().metaInfo,children:[(0,n.jsxs)("div",{className:i().metaItem,children:[n.jsx("div",{className:i().metaIcon,children:"\uD83D\uDCCD"}),(0,n.jsxs)("div",{className:i().metaContent,children:[n.jsx("span",{className:i().metaLabel,children:"Lokalizacja"}),n.jsx("span",{className:i().metaValue,children:e.location})]})]}),(0,n.jsxs)("div",{className:i().metaItem,children:[n.jsx("div",{className:i().metaIcon,children:"\uD83C\uDFF7️"}),(0,n.jsxs)("div",{className:i().metaContent,children:[n.jsx("span",{className:i().metaLabel,children:"Kategoria"}),n.jsx("span",{className:i().metaValue,children:e.category})]})]}),(0,n.jsxs)("div",{className:i().metaItem,children:[n.jsx("div",{className:i().metaIcon,children:"\uD83D\uDCC5"}),(0,n.jsxs)("div",{className:i().metaContent,children:[n.jsx("span",{className:i().metaLabel,children:"Data dodania"}),n.jsx("span",{className:i().metaValue,children:new Date(e.createdAt).toLocaleDateString("pl-PL",{day:"numeric",month:"long",year:"numeric"})})]})]})]}),(0,n.jsxs)("div",{className:i().descriptionSection,children:[n.jsx("h3",{className:i().sectionTitle,children:"Opis oferty"}),n.jsx("div",{className:i().description,children:e.description})]}),(0,n.jsxs)("div",{className:i().contactSection,children:[n.jsx("h3",{className:i().sectionTitle,children:"Kontakt"}),(0,n.jsxs)("div",{className:i().contactGrid,children:[(0,n.jsxs)("div",{className:`${i().contactItem} ${i().clickableUser}`,onClick:()=>window.open(`/user/${e.contactEmail}`,"_blank"),children:[n.jsx("div",{className:i().contactIcon,children:"\uD83D\uDC64"}),(0,n.jsxs)("div",{className:i().contactContent,children:[n.jsx("span",{className:i().contactLabel,children:"Imię"}),n.jsx("span",{className:i().contactValue,children:e.ownerName||e.owner?.name||e.contactName})]}),n.jsx("div",{className:i().viewProfileHint,children:n.jsx("span",{children:"\uD83D\uDC41️ Zobacz profil"})})]}),(0,n.jsxs)("div",{className:i().contactItem,children:[n.jsx("div",{className:i().contactIcon,children:"\uD83D\uDCE7"}),(0,n.jsxs)("div",{className:i().contactContent,children:[n.jsx("span",{className:i().contactLabel,children:"Email"}),n.jsx("span",{className:i().contactValue,children:e.contactEmail})]})]}),e.contactPhone&&(0,n.jsxs)("div",{className:i().contactItem,children:[n.jsx("div",{className:i().contactIcon,children:"\uD83D\uDCDE"}),(0,n.jsxs)("div",{className:i().contactContent,children:[n.jsx("span",{className:i().contactLabel,children:"Telefon"}),n.jsx("span",{className:i().contactValue,children:e.contactPhone})]})]})]})]}),(0,n.jsxs)("div",{className:i().actionSection,children:[(0,n.jsxs)("button",{className:i().primaryBtn,onClick:()=>window.open(`mailto:${e.contactEmail}?subject=Ogłoszenie: ${e.title}`),children:[n.jsx("span",{className:i().btnIcon,children:"\uD83D\uDCE7"}),"Wyślij email"]}),(0,n.jsxs)("button",{className:i().secondaryBtn,onClick:handleChatStart,children:[n.jsx("span",{className:i().btnIcon,children:"\uD83D\uDCAC"}),"Napisz wiadomość"]}),j&&j.email!==e.contactEmail&&(0,n.jsxs)("button",{className:`${i().ratingBtn} ${y?i().ratingSuccess:""}`,onClick:()=>!y&&p(!0),title:y?"Już oceniłeś tego użytkownika":"Oceń tego użytkownika po wsp\xf3łpracy",disabled:y,children:[n.jsx("span",{className:i().btnIcon,children:y?"✅":"⭐"}),y?"Ocena wystawiona":"Wystaw ocenę"]}),j&&j.email===e.contactEmail&&n.jsx("button",{className:i().promoteBtn,onClick:handlePromoteOffer,disabled:N,children:N?"Promowanie...":"Promuj ofertę"})]})]})]}),g&&n.jsx(RatingModal,{isOpen:g,onClose:()=>p(!1),userEmail:e.contactEmail,userName:e.contactEmail,offerId:e.id,offerTitle:e.title,onRatingAdded:()=>{p(!1),O(!0),setTimeout(()=>{alert("Ocena została wystawiona pomyślnie!")},100)}})]})}}};