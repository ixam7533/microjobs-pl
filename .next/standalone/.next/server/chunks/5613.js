"use strict";exports.id=5613,exports.ids=[5613],exports.modules={5613:(e,t,n)=>{n.d(t,{A:()=>getUserFromRequest});var o=n(4802),s=n(298),i=n(614),r=n(5066);async function getUserFromRequest(e){try{let t=await (0,i.getToken)({req:e,secret:process.env.NEXTAUTH_SECRET});if(t&&t.email){console.log("✅ auth.ts - NextAuth token znaleziony:",t.email);let e=await r.Z.user.findUnique({where:{email:t.email},select:{id:!0,email:!0}});if(!e){console.log("\uD83D\uDD27 auth.ts - Creating NextAuth user in database:",t.email);try{e=await r.Z.user.create({data:{email:t.email,name:t.name||null,image:t.picture||null,confirmed:!0,subscriptionType:null,subscriptionStart:null,subscriptionEnd:null,promotionsUsed:0,promotionsLimit:0},select:{id:!0,email:!0}}),console.log("✅ auth.ts - NextAuth user created:",e.email)}catch(e){return console.error("❌ auth.ts - Failed to create NextAuth user:",e),null}}return{id:e.id,email:e.email}}}catch(e){console.log("⚠️ auth.ts - błąd NextAuth token:",e.message)}let t=(0,o.parse)(e.headers.cookie||"");if(console.log("\uD83D\uDD0D auth.ts - dostępne cookies:",Object.keys(t)),console.log("\uD83D\uDD0D auth.ts - token cookie:",!!t.token),!t.token)return console.log("❌ auth.ts - brak token\xf3w"),null;try{let e=(0,s.W)(t.token);return console.log("✅ auth.ts - JWT token zweryfikowany:",e.email),e}catch(e){return console.log("❌ auth.ts - błąd weryfikacji JWT tokenu:",e.message),null}}},298:(e,t,n)=>{n.d(t,{W:()=>verifyToken,f:()=>signToken});var o=n(9344),s=n.n(o);let i=process.env.JWT_SECRET;if(!i)throw Error("JWT_SECRET is missing in environment variables");function signToken(e,t="7d"){let n={expiresIn:String(t)};return s().sign(e,i,n)}function verifyToken(e){return s().verify(e,i)}},5066:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(3524);let s=new o.PrismaClient,i=s}};