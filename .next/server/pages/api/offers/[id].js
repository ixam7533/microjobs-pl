"use strict";(()=>{var e={};e.id=9313,e.ids=[9313],e.modules={3524:e=>{e.exports=require("@prisma/client")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},71:(e,r,o)=>{o.r(r),o.d(r,{config:()=>f,default:()=>d,routeModule:()=>l});var t={};o.r(t),o.d(t,{default:()=>handler});var n=o(1802),i=o(7153),s=o(6249),a=o(5066),u=o(298);async function handler(e,r){let o=parseInt(e.query.id,10);if(isNaN(o))return r.status(400).json({error:"Invalid ID"});if("GET"===e.method){let e=await a.Z.offer.findUnique({where:{id:o},include:{images:{orderBy:{id:"asc"}}}});if(!e)return r.status(404).end();let t={...e,image:e.images.length>0?e.images[0].url:"/house4k.jpg",images:e.images.map(e=>e.url)};return r.status(200).json(t)}if("PUT"===e.method)try{let t;let n=e.cookies.token;if(console.log("PUT /api/offers/[id] - Token from cookies:",n?`Present (length: ${n.length})`:"Missing"),console.log("PUT /api/offers/[id] - All cookies:",e.cookies),!n)return r.status(401).json({error:"Token required"});try{t=(0,u.W)(n),console.log("PUT /api/offers/[id] - Token verification successful:",{userId:t?.id,email:t?.email})}catch(e){return console.error("PUT /api/offers/[id] - Token verification failed:",e),r.status(401).json({error:"Invalid token",details:e?.message||"Token verification failed"})}if(!t||!t.id)return r.status(401).json({error:"Invalid token - missing user id"});let i=await a.Z.offer.findUnique({where:{id:o}});if(!i)return r.status(404).json({error:"Offer not found"});if(i.ownerId!==t.id)return r.status(403).json({error:"You can only edit your own offers"});let{title:s,description:d,price:f,locationProvince:l,locationCity:c,locationDetails:g,location:p,contactName:m,contactEmail:k,contactPhone:T}=e.body,h=await a.Z.offer.update({where:{id:o},data:{title:s,description:d,price:parseFloat(f)||0,location:p,contactName:m,contactEmail:k,contactPhone:T||null,updatedAt:new Date},include:{images:{orderBy:{id:"asc"}}}});return r.status(200).json({...h,image:h.images.length>0?h.images[0].url:"/house4k.jpg",images:h.images.map(e=>e.url)})}catch(e){return console.error("Error updating offer:",e),r.status(500).json({error:"Failed to update offer"})}if("DELETE"===e.method)try{let t=e.cookies.token;if(!t)return r.status(401).json({error:"Token required"});let n=(0,u.W)(t);if(!n||!n.id)return r.status(401).json({error:"Invalid token"});let i=await a.Z.offer.findUnique({where:{id:o}});if(!i)return r.status(404).json({error:"Offer not found"});if(i.ownerId!==n.id)return r.status(403).json({error:"You can only delete your own offers"});return await a.Z.offer.delete({where:{id:o}}),r.status(200).json({success:!0})}catch(e){return console.error("Error deleting offer:",e),r.status(500).json({error:"Failed to delete offer"})}return r.setHeader("Allow",["GET","PUT","DELETE"]),r.status(405).end()}let d=(0,s.l)(t,"default"),f=(0,s.l)(t,"config"),l=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/offers/[id]",pathname:"/api/offers/[id]",bundlePath:"",filename:""},userland:t})},298:(e,r,o)=>{o.d(r,{W:()=>verifyToken,f:()=>signToken});var t=o(9344),n=o.n(t);let i=process.env.JWT_SECRET;if(!i)throw Error("JWT_SECRET is missing in environment variables");function signToken(e,r="7d"){let o={expiresIn:String(r)};return n().sign(e,i,o)}function verifyToken(e){return n().verify(e,i)}},5066:(e,r,o)=>{o.d(r,{Z:()=>i});var t=o(3524);let n=new t.PrismaClient,i=n}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),o=r.X(0,[4222],()=>__webpack_exec__(71));module.exports=o})();