"use strict";(()=>{var e={};e.id=6608,e.ids=[6608],e.modules={3524:e=>{e.exports=require("@prisma/client")},4802:e=>{e.exports=require("cookie")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4869:(e,r,i)=>{i.r(r),i.d(r,{config:()=>c,default:()=>l,routeModule:()=>p});var n={};i.r(n),i.d(n,{default:()=>handler});var s=i(1802),t=i(7153),o=i(6249),a=i(298),u=i(4802),d=i(5066);async function handler(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let i=(0,u.parse)(e.headers.cookie||""),n=i.token;if(!n)return r.status(401).json({error:"Token required"});let s=(0,a.W)(n);if(!s||!s.id)return r.status(401).json({error:"Invalid token"});let t=await d.Z.user.findUnique({where:{id:parseInt(s.id)}}),o=t?.isAdmin||t?.email==="microjobsj7@gmail.com";if(!o)return r.status(403).json({error:"Admin access required"});let{userEmail:l,subscriptionType:c,duration:p}=e.body;if(!l||!c)return r.status(400).json({error:"User email and subscription type are required"});if(!["FREE","PRO","PRO_PLUS"].includes(c))return r.status(400).json({error:"Invalid subscription type"});let m=await d.Z.user.findUnique({where:{email:l}});if(!m)return r.status(404).json({error:"User not found"});let f=new Date,g=null;if("FREE"!==c){let e=p||30;(g=new Date).setDate(g.getDate()+e)}let b={subscriptionType:c,subscriptionStart:f,subscriptionEnd:g,promotionsUsed:0},v=await d.Z.user.update({where:{id:m.id},data:b});console.log(`ðŸ‘‘ Admin ${s.email} granted ${c} to ${l} for ${p||30} days`),r.status(200).json({success:!0,message:`Successfully granted ${c} subscription to ${l}`,user:{email:v.email,subscriptionType:v.subscriptionType,subscriptionEnd:v.subscriptionEnd}})}catch(e){console.error("Admin manage subscription error:",e),r.status(500).json({error:"Internal server error"})}}let l=(0,o.l)(n,"default"),c=(0,o.l)(n,"config"),p=new s.PagesAPIRouteModule({definition:{kind:t.x.PAGES_API,page:"/api/admin/manage-subscription",pathname:"/api/admin/manage-subscription",bundlePath:"",filename:""},userland:n})},298:(e,r,i)=>{i.d(r,{W:()=>verifyToken,f:()=>signToken});var n=i(9344),s=i.n(n);let t=process.env.JWT_SECRET;if(!t)throw Error("JWT_SECRET is missing in environment variables");function signToken(e,r="7d"){let i={expiresIn:String(r)};return s().sign(e,t,i)}function verifyToken(e){return s().verify(e,t)}},5066:(e,r,i)=>{i.d(r,{Z:()=>t});var n=i(3524);let s=new n.PrismaClient,t=s}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),i=r.X(0,[4222],()=>__webpack_exec__(4869));module.exports=i})();