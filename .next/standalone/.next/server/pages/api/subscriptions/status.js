"use strict";(()=>{var e={};e.id=1379,e.ids=[1379],e.modules={3524:e=>{e.exports=require("@prisma/client")},4802:e=>{e.exports=require("cookie")},9344:e=>{e.exports=require("jsonwebtoken")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3568:(e,t,s)=>{s.r(t),s.d(t,{config:()=>d,default:()=>p,routeModule:()=>l});var i={};s.r(i),s.d(i,{default:()=>handler});var r=s(1802),o=s(7153),n=s(6249),a=s(614),u=s(5613),c=s(5066);async function handler(e,t){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let s=null,i=await (0,a.getToken)({req:e,secret:process.env.NEXTAUTH_SECRET});if(i&&i.email&&(s={email:i.email}),!s){let t=await (0,u.A)(e);t&&(s=t)}if(!s)return t.status(401).json({error:"Not authenticated"});let r=await c.Z.user.findUnique({where:{email:s.email},include:{subscriptions:{where:{OR:[{status:"ACTIVE"},{status:"CANCELLED"}]},orderBy:{createdAt:"desc"},take:1}}});if(!r)return t.status(404).json({error:"User not found"});let o=new Date,n=r.subscriptionEnd&&r.subscriptionEnd>o,p=r.subscriptions[0],d=p?.status==="CANCELLED"&&n,l=0;if(n&&r.subscriptionType)switch(r.subscriptionType){case"PRO":l=1;break;case"PRO_PLUS":l=3;break;default:l=0}console.log("\uD83D\uDD0D Subscription status check:",{userId:r.id,email:r.email,subscriptionType:r.subscriptionType,promotionsUsed:r.promotionsUsed,promotionsLimit:l,hasActiveSubscription:n,subscriptionEnd:r.subscriptionEnd}),t.status(200).json({success:!0,subscription:{isActive:n,isCancelled:d,type:r.subscriptionType,startDate:r.subscriptionStart,endDate:r.subscriptionEnd,promotionsUsed:r.promotionsUsed,promotionsLimit:l,emailReminder:r.emailReminder,autoRenew:!!p&&p.autoRenew,daysRemaining:n?Math.ceil((r.subscriptionEnd.getTime()-o.getTime())/864e5):0}})}catch(e){console.error("Get subscription status error:",e),t.status(500).json({error:"Internal server error"})}}let p=(0,n.l)(i,"default"),d=(0,n.l)(i,"config"),l=new r.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/subscriptions/status",pathname:"/api/subscriptions/status",bundlePath:"",filename:""},userland:i})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[4222,5613],()=>__webpack_exec__(3568));module.exports=s})();