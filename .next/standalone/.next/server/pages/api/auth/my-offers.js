"use strict";(()=>{var e={};e.id=5961,e.ids=[5961],e.modules={3524:e=>{e.exports=require("@prisma/client")},9344:e=>{e.exports=require("jsonwebtoken")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5876:(e,r,t)=>{t.r(r),t.d(r,{config:()=>m,default:()=>u,routeModule:()=>f});var n={};t.r(n),t.d(n,{default:()=>handler});var o=t(1802),i=t(7153),a=t(6249),s=t(298),d=t(614),l=t(5066);async function handler(e,r){if("GET"!==e.method)return r.setHeader("Allow",["GET"]),r.status(405).end();try{let t=null,n=await (0,d.getToken)({req:e,secret:process.env.NEXTAUTH_SECRET});if(n&&n.email){let e=await l.Z.user.findUnique({where:{email:n.email},select:{id:!0}});e&&(t=e.id)}if(!t){let n=e.cookies.token;if(!n)return r.status(401).json({error:"Not authenticated"});let o=(0,s.W)(n);if(!o||"string"==typeof o||!o.id)return r.status(401).json({error:"Invalid token"});t=o.id}if(!t)return r.status(401).json({error:"User not found"});let o=new Date;await l.Z.offer.updateMany({where:{promoted:!0,promotedUntil:{lt:o}},data:{promoted:!1,promotedUntil:null}});let i=await l.Z.offer.findMany({where:{ownerId:t},orderBy:[{promoted:"desc"},{createdAt:"desc"}],include:{images:{orderBy:{id:"asc"}},owner:{select:{id:!0,email:!0,name:!0}}}}),a=i.map(e=>({...e,ownerEmail:e.owner.email,ownerName:e.owner.name,image:e.images.length>0?e.images[0].url:"/house4k.jpg",images:e.images.map(e=>e.url),isPromoted:e.promoted&&e.promotedUntil&&e.promotedUntil>o}));return r.status(200).json({offers:a})}catch(e){return console.error("My offers API error:",e),r.status(500).json({error:"Internal server error"})}}let u=(0,a.l)(n,"default"),m=(0,a.l)(n,"config"),f=new o.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/auth/my-offers",pathname:"/api/auth/my-offers",bundlePath:"",filename:""},userland:n})},298:(e,r,t)=>{t.d(r,{W:()=>verifyToken,f:()=>signToken});var n=t(9344),o=t.n(n);let i=process.env.JWT_SECRET;if(!i)throw Error("JWT_SECRET is missing in environment variables");function signToken(e,r="7d"){let t={expiresIn:String(r)};return o().sign(e,i,t)}function verifyToken(e){return o().verify(e,i)}},5066:(e,r,t)=>{t.d(r,{Z:()=>i});var n=t(3524);let o=new n.PrismaClient,i=o}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[4222],()=>__webpack_exec__(5876));module.exports=t})();