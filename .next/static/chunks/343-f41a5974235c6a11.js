(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[343],{2682:function(e,a,t){"use strict";t.d(a,{Z:function(){return OfferModal}});var n=t(5893),o=t(7294),c=t(7159),l=t.n(c),i=t(6315),s=t.n(i);function RatingModal(e){let{isOpen:a,onClose:t,userEmail:c,userName:l,offerId:i,offerTitle:r,onRatingAdded:d}=e,[m,_]=(0,o.useState)(0),[u,f]=(0,o.useState)(0),[h,g]=(0,o.useState)(""),[p,j]=(0,o.useState)(!1),handleSubmit=async e=>{if(e.preventDefault(),0!==m){j(!0);try{let e=await fetch("/api/ratings/add",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({reviewedEmail:c,rating:m,comment:h,offerId:i})});if(e.ok)d(),t(),_(0),g("");else{let a=await e.json();alert(a.message||"Błąd podczas dodawania oceny")}}catch(e){console.error("Error adding rating:",e),alert("Błąd podczas dodawania oceny")}finally{j(!1)}}};return a?(0,n.jsx)("div",{className:s().modalOverlay,onClick:t,children:(0,n.jsxs)("div",{className:s().modalContent,onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:s().modalHeader,children:[(0,n.jsx)("h2",{children:"Oceń użytkownika"}),(0,n.jsx)("button",{className:s().closeButton,onClick:t,children:"\xd7"})]}),(0,n.jsxs)("div",{className:s().modalBody,children:[(0,n.jsxs)("div",{className:s().userInfo,children:[(0,n.jsx)("h3",{children:l}),r&&(0,n.jsxs)("p",{className:s().offerTitle,children:["Za: ",r]})]}),(0,n.jsxs)("form",{onSubmit:handleSubmit,children:[(0,n.jsxs)("div",{className:s().ratingSection,children:[(0,n.jsx)("label",{children:"Twoja ocena:"}),(0,n.jsx)("div",{className:s().starsContainer,children:(()=>{let e=[];for(let a=1;a<=5;a++)e.push((0,n.jsx)("button",{type:"button",className:"".concat(s().star," ").concat(a<=(u||m)?s().filled:""),onClick:()=>_(a),onMouseEnter:()=>f(a),onMouseLeave:()=>f(0),children:"⭐"},a));return e})()}),(0,n.jsx)("span",{className:s().ratingText,children:0===m?"Wybierz ocenę":"".concat(m," ").concat(1===m?"gwiazdka":m<5?"gwiazdki":"gwiazdek")})]}),(0,n.jsxs)("div",{className:s().commentSection,children:[(0,n.jsx)("label",{htmlFor:"comment",children:"Komentarz (opcjonalnie):"}),(0,n.jsx)("textarea",{id:"comment",value:h,onChange:e=>g(e.target.value),placeholder:"Opisz swoje doświadczenie...",rows:4,maxLength:500}),(0,n.jsxs)("div",{className:s().charCount,children:[h.length,"/500"]})]}),(0,n.jsxs)("div",{className:s().modalFooter,children:[(0,n.jsx)("button",{type:"button",onClick:t,className:s().cancelButton,children:"Anuluj"}),(0,n.jsx)("button",{type:"submit",disabled:0===m||p,className:s().submitButton,children:p?"Dodawanie...":"Dodaj ocenę"})]})]})]})]})}):null}function OfferModal(e){var a,t;let{offer:c,isOpen:i,onClose:s}=e,[r,d]=(0,o.useState)(0),[m,_]=(0,o.useState)(!1),[u,f]=(0,o.useState)(null),[h,g]=(0,o.useState)(null),[p,j]=(0,o.useState)("natura"),[x,N]=(0,o.useState)(!1),[v,y]=(0,o.useState)(null),[O,b]=(0,o.useState)(!1),[M,k]=(0,o.useState)(!1);(0,o.useEffect)(()=>{console.log("\uD83D\uDD0D OfferModal: Sprawdzam aktualnego użytkownika..."),fetch("/api/auth/me").then(e=>(console.log("\uD83D\uDCE5 /api/auth/me response status:",e.status),e.json())).then(e=>{console.log("\uD83D\uDC64 API /api/auth/me response:",e),e.user?(y(e.user),console.log("✅ Użytkownik zalogowany:",e.user.email),checkIfAlreadyRated(e.user.email)):console.log("❌ Użytkownik nie zalogowany")}).catch(e=>{console.error("\uD83D\uDCA5 Error fetching user:",e)})},[]);let checkIfAlreadyRated=async e=>{try{let e=await fetch("/api/ratings/check?reviewedEmail=".concat(c.contactEmail,"&offerId=").concat(c.id),{credentials:"include"});if(e.ok){let a=await e.json();k(a.hasRated)}}catch(e){console.error("Error checking rating:",e)}};if((0,o.useEffect)(()=>{let e=new MutationObserver(()=>{let e=document.documentElement.getAttribute("data-theme")||"natura";j(e)});e.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]});let a=document.documentElement.getAttribute("data-theme")||"natura";return j(a),()=>e.disconnect()},[]),(0,o.useEffect)(()=>{if(i){document.body.style.overflow="hidden",window.scrollTo({top:0,behavior:"smooth"});let handleKeyPress=e=>{"ArrowLeft"===e.key?prevImage():"ArrowRight"===e.key?nextImage():"Escape"===e.key&&s()};return document.addEventListener("keydown",handleKeyPress),()=>{document.removeEventListener("keydown",handleKeyPress)}}return document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}},[i]),!i||!c)return null;let w=(null===(a=c.images)||void 0===a?void 0:a.length)?c.images:[c.image||"/house4k.jpg"],nextImage=()=>{_(!0),setTimeout(()=>{d(e=>(e+1)%w.length),_(!1)},200)},prevImage=()=>{_(!0),setTimeout(()=>{d(e=>(e-1+w.length)%w.length),_(!1)},200)},handleChatStart=async()=>{try{let e=await fetch("/api/auth/chats/new",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({withEmail:c.ownerEmail||c.contactEmail,offerId:c.id})});if(e.ok){let a=await e.json();console.log("✅ Chat utworzony:",a);try{let e=JSON.parse(localStorage.getItem("chatOfferMap")||"{}");e[a.chatId]=c.id,localStorage.setItem("chatOfferMap",JSON.stringify(e)),console.log("\uD83D\uDCBE Saved chat-offer mapping:",{chatId:a.chatId,offerId:c.id})}catch(e){console.error("⚠️ Failed to save chat-offer mapping:",e)}window.location.href="/profile?tab=chat&chatId=".concat(a.chatId,"&offerId=").concat(c.id)}else{let a=await e.json();console.log("❌ Błąd API:",a),alert(a.error||"Błąd podczas rozpoczynania chatu")}}catch(e){console.error("\uD83D\uDCA5 Wyjątek podczas tworzenia czatu:",e),alert("Błąd podczas rozpoczynania chatu")}},handlePromoteOffer=async()=>{b(!0);try{let e=await fetch("/api/offers/promote",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({offerId:c.id})});if(e.ok){let a=await e.json();alert("Oferta została promowana pomyślnie! Pozostało promowań: ".concat(a.promotionsRemaining)),s()}else{let a=await e.json();alert(a.error||"Błąd podczas promowania oferty")}}catch(e){console.error("Error promoting offer:",e),alert("Błąd podczas promowania oferty")}finally{b(!1)}};return(0,n.jsxs)("div",{className:l().modalOverlay,onClick:e=>{let a=e.target;a.closest("header")||a.closest('[data-header="true"]')||e.target!==e.currentTarget||s()},children:[(0,n.jsxs)("div",{className:l().bgContainer,children:[(()=>{switch(p){case"light":return(0,n.jsx)("video",{className:l().bgVideo,src:"/chmury.mp4",autoPlay:!0,loop:!0,muted:!0,playsInline:!0});case"dark":return(0,n.jsx)("video",{className:l().bgVideo,src:"/smoke.mp4",autoPlay:!0,loop:!0,muted:!0,playsInline:!0});case"night":return(0,n.jsx)("div",{className:l().nightBackground});default:return(0,n.jsx)("div",{className:l().naturaBackground})}})(),(0,n.jsx)("div",{className:l().bgTint})]}),(0,n.jsxs)("div",{className:l().modalContent,onClick:e=>{e.stopPropagation()},children:[(0,n.jsx)("button",{className:l().closeBtn,onClick:s,children:(0,n.jsx)("span",{children:"\xd7"})}),(0,n.jsxs)("div",{className:l().imagesSection,children:[(0,n.jsxs)("div",{className:l().mainImageContainer,children:[m&&(0,n.jsx)("div",{className:l().loadingSpinner}),(0,n.jsx)("img",{src:w[r],alt:"Zdjęcie ".concat(r+1),className:l().mainImage,style:{opacity:m?.7:1},onTouchStart:e=>{g(null),f(e.targetTouches[0].clientX)},onTouchMove:e=>{g(e.targetTouches[0].clientX)},onTouchEnd:()=>{if(!u||!h)return;let e=u-h;e>50&&w.length>1&&nextImage(),e<-50&&w.length>1&&prevImage()}}),(0,n.jsx)("div",{className:l().imageOverlay}),w.length>1&&(0,n.jsxs)("div",{className:l().imageIndicator,children:[r+1," / ",w.length]}),w.length>1&&(0,n.jsx)("div",{className:l().keyboardHints,children:"← → lub kliknij aby przewijać"}),w.length>1&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"".concat(l().imageNavigation," ").concat(l().prevBtn),onClick:prevImage,"aria-label":"Poprzednie zdjęcie",disabled:m,children:"←"}),(0,n.jsx)("button",{className:"".concat(l().imageNavigation," ").concat(l().nextBtn),onClick:nextImage,"aria-label":"Następne zdjęcie",disabled:m,children:"→"})]})]}),w.length>1&&(0,n.jsx)("div",{className:l().thumbnails,children:w.map((e,a)=>(0,n.jsx)("img",{src:e,alt:"Miniatura ".concat(a+1),className:"".concat(l().thumbnail," ").concat(a===r?l().activeThumbnail:""),onClick:()=>{_(!0),setTimeout(()=>{d(a),_(!1)},150)}},a))})]}),(0,n.jsxs)("div",{className:l().contentSection,children:[(0,n.jsxs)("div",{className:l().titleSection,children:[(0,n.jsx)("h1",{className:l().title,children:c.title}),(0,n.jsx)("div",{className:l().priceTag,children:(0,n.jsxs)("span",{className:l().price,children:[c.price||100," zł"]})})]}),(0,n.jsxs)("div",{className:l().metaInfo,children:[(0,n.jsxs)("div",{className:l().metaItem,children:[(0,n.jsx)("div",{className:l().metaIcon,children:"\uD83D\uDCCD"}),(0,n.jsxs)("div",{className:l().metaContent,children:[(0,n.jsx)("span",{className:l().metaLabel,children:"Lokalizacja"}),(0,n.jsx)("span",{className:l().metaValue,children:c.location})]})]}),(0,n.jsxs)("div",{className:l().metaItem,children:[(0,n.jsx)("div",{className:l().metaIcon,children:"\uD83C\uDFF7️"}),(0,n.jsxs)("div",{className:l().metaContent,children:[(0,n.jsx)("span",{className:l().metaLabel,children:"Kategoria"}),(0,n.jsx)("span",{className:l().metaValue,children:c.category})]})]}),(0,n.jsxs)("div",{className:l().metaItem,children:[(0,n.jsx)("div",{className:l().metaIcon,children:"\uD83D\uDCC5"}),(0,n.jsxs)("div",{className:l().metaContent,children:[(0,n.jsx)("span",{className:l().metaLabel,children:"Data dodania"}),(0,n.jsx)("span",{className:l().metaValue,children:new Date(c.createdAt).toLocaleDateString("pl-PL",{day:"numeric",month:"long",year:"numeric"})})]})]})]}),(0,n.jsxs)("div",{className:l().descriptionSection,children:[(0,n.jsx)("h3",{className:l().sectionTitle,children:"Opis oferty"}),(0,n.jsx)("div",{className:l().description,children:c.description})]}),(0,n.jsxs)("div",{className:l().contactSection,children:[(0,n.jsx)("h3",{className:l().sectionTitle,children:"Kontakt"}),(0,n.jsxs)("div",{className:l().contactGrid,children:[(0,n.jsxs)("div",{className:"".concat(l().contactItem," ").concat(l().clickableUser),onClick:()=>window.open("/user/".concat(c.contactEmail),"_blank"),children:[(0,n.jsx)("div",{className:l().contactIcon,children:"\uD83D\uDC64"}),(0,n.jsxs)("div",{className:l().contactContent,children:[(0,n.jsx)("span",{className:l().contactLabel,children:"Imię"}),(0,n.jsx)("span",{className:l().contactValue,children:c.ownerName||(null===(t=c.owner)||void 0===t?void 0:t.name)||c.contactName})]}),(0,n.jsx)("div",{className:l().viewProfileHint,children:(0,n.jsx)("span",{children:"\uD83D\uDC41️ Zobacz profil"})})]}),(0,n.jsxs)("div",{className:l().contactItem,children:[(0,n.jsx)("div",{className:l().contactIcon,children:"\uD83D\uDCE7"}),(0,n.jsxs)("div",{className:l().contactContent,children:[(0,n.jsx)("span",{className:l().contactLabel,children:"Email"}),(0,n.jsx)("span",{className:l().contactValue,children:c.contactEmail})]})]}),c.contactPhone&&(0,n.jsxs)("div",{className:l().contactItem,children:[(0,n.jsx)("div",{className:l().contactIcon,children:"\uD83D\uDCDE"}),(0,n.jsxs)("div",{className:l().contactContent,children:[(0,n.jsx)("span",{className:l().contactLabel,children:"Telefon"}),(0,n.jsx)("span",{className:l().contactValue,children:c.contactPhone})]})]})]})]}),(0,n.jsxs)("div",{className:l().actionSection,children:[(0,n.jsxs)("button",{className:l().primaryBtn,onClick:()=>window.open("mailto:".concat(c.contactEmail,"?subject=Ogłoszenie: ").concat(c.title)),children:[(0,n.jsx)("span",{className:l().btnIcon,children:"\uD83D\uDCE7"}),"Wyślij email"]}),(0,n.jsxs)("button",{className:l().secondaryBtn,onClick:handleChatStart,children:[(0,n.jsx)("span",{className:l().btnIcon,children:"\uD83D\uDCAC"}),"Napisz wiadomość"]}),v&&v.email!==c.contactEmail&&(0,n.jsxs)("button",{className:"".concat(l().ratingBtn," ").concat(M?l().ratingSuccess:""),onClick:()=>!M&&N(!0),title:M?"Już oceniłeś tego użytkownika":"Oceń tego użytkownika po wsp\xf3łpracy",disabled:M,children:[(0,n.jsx)("span",{className:l().btnIcon,children:M?"✅":"⭐"}),M?"Ocena wystawiona":"Wystaw ocenę"]}),v&&v.email===c.contactEmail&&(0,n.jsx)("button",{className:l().promoteBtn,onClick:handlePromoteOffer,disabled:O,children:O?"Promowanie...":"Promuj ofertę"})]})]})]}),x&&(0,n.jsx)(RatingModal,{isOpen:x,onClose:()=>N(!1),userEmail:c.contactEmail,userName:c.contactEmail,offerId:c.id,offerTitle:c.title,onRatingAdded:()=>{N(!1),k(!0),setTimeout(()=>{alert("Ocena została wystawiona pomyślnie!")},100)}})]})}},7159:function(e){e.exports={modalOverlay:"OfferModal_modalOverlay__zOASt",bgContainer:"OfferModal_bgContainer__1xH_L",bgVideo:"OfferModal_bgVideo__lb17Q",nightBackground:"OfferModal_nightBackground__2Kcd0",naturaBackground:"OfferModal_naturaBackground__VVe_V",bgTint:"OfferModal_bgTint__9j4kX",modalContent:"OfferModal_modalContent__kVKRB",modalAppear:"OfferModal_modalAppear__eskWo",closeBtn:"OfferModal_closeBtn__xcikq",imagesSection:"OfferModal_imagesSection__gnvI_",mainImageContainer:"OfferModal_mainImageContainer__iespG",mainImage:"OfferModal_mainImage__WSege",imageOverlay:"OfferModal_imageOverlay__VRhd7",thumbnails:"OfferModal_thumbnails__gNeXR",thumbnail:"OfferModal_thumbnail__dAze7",activeThumbnail:"OfferModal_activeThumbnail__8lxLu",imageNavigation:"OfferModal_imageNavigation__O6mUb",prevBtn:"OfferModal_prevBtn__Q1Ohx",nextBtn:"OfferModal_nextBtn__AHfPe",imageIndicator:"OfferModal_imageIndicator__0vFGh",contentSection:"OfferModal_contentSection__WN0Cc",titleSection:"OfferModal_titleSection__KpDwo",title:"OfferModal_title__UkYDo",priceTag:"OfferModal_priceTag__VZeCI",shimmer:"OfferModal_shimmer__vZguw",price:"OfferModal_price__XqApu",metaInfo:"OfferModal_metaInfo__qoqmk",metaItem:"OfferModal_metaItem__X8H4j",metaIcon:"OfferModal_metaIcon__u4f8t",metaContent:"OfferModal_metaContent__hHcMY",metaLabel:"OfferModal_metaLabel__UP3Q_",metaValue:"OfferModal_metaValue__qXrrM",sectionTitle:"OfferModal_sectionTitle__k7MOY",descriptionSection:"OfferModal_descriptionSection__kR1i2",description:"OfferModal_description__iFXs4",contactSection:"OfferModal_contactSection__OS9gi",contactGrid:"OfferModal_contactGrid__U8xZk",contactItem:"OfferModal_contactItem__pj_Ww",contactIcon:"OfferModal_contactIcon__dCo_6",contactContent:"OfferModal_contactContent__DHoIF",contactLabel:"OfferModal_contactLabel__XS5HV",contactValue:"OfferModal_contactValue__J0vRx",actionSection:"OfferModal_actionSection__TFDXg",primaryBtn:"OfferModal_primaryBtn__35fBX",secondaryBtn:"OfferModal_secondaryBtn__tI2OI",ratingBtn:"OfferModal_ratingBtn__gplVr",btnIcon:"OfferModal_btnIcon__GFNP8",starGlow:"OfferModal_starGlow__tkKai",promoteBtn:"OfferModal_promoteBtn__DiN0H",loadingSpinner:"OfferModal_loadingSpinner__w6UrO",spin:"OfferModal_spin__P_C6B",keyboardHints:"OfferModal_keyboardHints__fZ5t_",clickableUser:"OfferModal_clickableUser__kewUz",viewProfileHint:"OfferModal_viewProfileHint__0Yak_",pulse:"OfferModal_pulse__DqkM0",ratingSuccess:"OfferModal_ratingSuccess__IsKii",checkmarkBounce:"OfferModal_checkmarkBounce__N5z5u",adSection:"OfferModal_adSection__axsld"}},6315:function(e){e.exports={modalOverlay:"RatingModal_modalOverlay__YThcA",modalContent:"RatingModal_modalContent__2nqJL",modalSlideIn:"RatingModal_modalSlideIn__LJVkL",modalHeader:"RatingModal_modalHeader__KN8mK",closeButton:"RatingModal_closeButton__Jv1O3",modalBody:"RatingModal_modalBody__3SVaA",userInfo:"RatingModal_userInfo__OpyjA",offerTitle:"RatingModal_offerTitle__VaVMY",ratingSection:"RatingModal_ratingSection__etugJ",starsContainer:"RatingModal_starsContainer__AKK_s",star:"RatingModal_star__A4d4y",filled:"RatingModal_filled__JubPp",ratingText:"RatingModal_ratingText__S1oQS",commentSection:"RatingModal_commentSection__3ywTA",charCount:"RatingModal_charCount__RxPVr",modalFooter:"RatingModal_modalFooter__nPbL0",cancelButton:"RatingModal_cancelButton__EXSFm",submitButton:"RatingModal_submitButton__D6yr7"}}}]);