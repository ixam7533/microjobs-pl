"use strict";(()=>{var e={};e.id=1769,e.ids=[1769],e.modules={3524:e=>{e.exports=require("@prisma/client")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5656:(e,r,o)=>{o.r(r),o.d(r,{config:()=>D,default:()=>c,routeModule:()=>p});var n={};o.r(n),o.d(n,{default:()=>handler});var t=o(1802),s=o(7153),u=o(6249),a=o(3524),l=o(9344),d=o.n(l);let i=new a.PrismaClient;async function handler(e,r){if("GET"!==e.method)return r.status(405).json({error:"Method not allowed"});try{console.log("\uD83D\uDD14 Unread count API called");let o=e.cookies.token;if(console.log("\uD83D\uDD14 Token present:",!!o),!o)return console.log("\uD83D\uDD14 No token found"),r.status(401).json({error:"Not authenticated"});let n=d().verify(o,process.env.JWT_SECRET);console.log("\uD83D\uDD14 Decoded token:",n);let t=n.userId||n.id;if(console.log("\uD83D\uDD14 User ID:",t),!t)return console.log("\uD83D\uDD14 Invalid token - no userId"),r.status(401).json({error:"Invalid token"});if(!t)return r.status(400).json({error:"User ID not found in token"});let s=await i.chat.findMany({where:{participants:{some:{userId:parseInt(t)}}},include:{messages:{where:{senderId:{not:parseInt(t)}},orderBy:{createdAt:"desc"}}}}),u=s.reduce((e,r)=>e+r.messages.length,0);return console.log("\uD83D\uDD14 Total unread count:",u),console.log("\uD83D\uDD14 Chats found:",s.length),r.status(200).json({unreadCount:u})}catch(e){return console.error("\uD83D\uDD14 Error fetching unread messages count:",e),r.status(500).json({error:"Internal server error"})}}let c=(0,u.l)(n,"default"),D=(0,u.l)(n,"config"),p=new t.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/messages/unread-count",pathname:"/api/messages/unread-count",bundlePath:"",filename:""},userland:n})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),o=r.X(0,[4222],()=>__webpack_exec__(5656));module.exports=o})();