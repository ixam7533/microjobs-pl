"use strict";(()=>{var e={};e.id=9661,e.ids=[9661],e.modules={3524:e=>{e.exports=require("@prisma/client")},4802:e=>{e.exports=require("cookie")},9344:e=>{e.exports=require("jsonwebtoken")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7218:(e,i,t)=>{t.r(i),t.d(i,{config:()=>d,default:()=>p,routeModule:()=>m});var s={};t.r(s),t.d(s,{default:()=>handler});var r=t(1802),o=t(7153),n=t(6249),a=t(614),u=t(3524),l=t(5613);let c=new u.PrismaClient;async function handler(e,i){console.log("\uD83D\uDD0D /api/auth/me called"),console.log("\uD83C\uDF6A Cookies:",Object.keys(e.cookies));let t=null,s=await (0,a.getToken)({req:e,secret:process.env.NEXTAUTH_SECRET});if(console.log("\uD83D\uDD11 NextAuth token:",!!s),s&&s.email&&(t={email:s.email},console.log("✅ NextAuth user:",s.email)),!t){let i=await (0,l.A)(e);console.log("\uD83D\uDD11 JWT user:",!!i),i&&(t=i,console.log("✅ JWT user:",i.email))}if(!t)return console.log("❌ No user found"),i.status(401).json({user:null});let r=await c.user.findUnique({where:{email:t.email},select:{id:!0,email:!0,name:!0,confirmed:!0,subscriptionType:!0,subscriptionStart:!0,subscriptionEnd:!0,promotionsUsed:!0,emailReminder:!0,isAdmin:!0}});if(!r&&s){console.log("\uD83D\uDD27 Creating NextAuth user in database:",s.email);try{r=await c.user.create({data:{email:s.email,name:s.name||null,image:s.picture||null,confirmed:!0,subscriptionType:null,subscriptionStart:null,subscriptionEnd:null,promotionsUsed:0,emailReminder:!0},select:{id:!0,email:!0,confirmed:!0,name:!0,image:!0,subscriptionType:!0,subscriptionStart:!0,subscriptionEnd:!0,promotionsUsed:!0,emailReminder:!0,isAdmin:!0}}),console.log("✅ NextAuth user created:",r.email)}catch(e){return console.error("❌ Failed to create NextAuth user:",e),i.status(500).json({error:"Failed to create user"})}}if(!r)return console.log("❌ User still not found after creation attempt"),i.status(404).json({user:null});let o=new Date,n=r.subscriptionEnd&&r.subscriptionEnd>o,u=0;if(n&&r.subscriptionType)switch(r.subscriptionType){case"PRO":u=1;break;case"PRO_PLUS":u=3;break;default:u=0}let p={...r,hasPro:n,proType:n?r.subscriptionType:null,promotionsRemaining:n?u-r.promotionsUsed:0};return i.status(200).json({user:p})}let p=(0,n.l)(s,"default"),d=(0,n.l)(s,"config"),m=new r.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/auth/me",pathname:"/api/auth/me",bundlePath:"",filename:""},userland:s})}};var i=require("../../../webpack-api-runtime.js");i.C(e);var __webpack_exec__=e=>i(i.s=e),t=i.X(0,[4222,5613],()=>__webpack_exec__(7218));module.exports=t})();