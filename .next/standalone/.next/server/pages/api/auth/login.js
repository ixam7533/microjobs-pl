"use strict";(()=>{var e={};e.id=3908,e.ids=[3908],e.modules={3524:e=>{e.exports=require("@prisma/client")},7096:e=>{e.exports=require("bcrypt")},4802:e=>{e.exports=require("cookie")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3535:(e,r,i)=>{i.r(r),i.d(r,{config:()=>m,default:()=>c,routeModule:()=>w});var t={};i.r(t),i.d(t,{default:()=>handler});var n=i(1802),a=i(7153),s=i(6249),o=i(4802),u=i(3524),d=i(7096),l=i.n(d),p=i(298);let f=new u.PrismaClient;async function handler(e,r){if("POST"!==e.method)return r.status(405).end();let{email:i,password:t,remember:n}=e.body;if(!i||!t)return r.status(400).json({error:"Wypełnij wszystkie pola."});let a=await f.user.findUnique({where:{email:i}});if(!a||!a.hash)return r.status(401).json({error:"Nieprawidłowe dane."});if(!a.confirmed)return r.status(403).json({error:"Potwierdź e-mail."});let s=await l().compare(t,a.hash);if(!s)return r.status(401).json({error:"Nieprawidłowe dane."});let u=n?2592e3:28800,d=(0,p.f)({id:a.id,email:i},`${u}s`);return r.setHeader("Set-Cookie",(0,o.serialize)("token",d,{httpOnly:!0,path:"/",maxAge:u,sameSite:"lax",secure:!0})),r.status(200).json({email:a.email})}let c=(0,s.l)(t,"default"),m=(0,s.l)(t,"config"),w=new n.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/auth/login",pathname:"/api/auth/login",bundlePath:"",filename:""},userland:t})},298:(e,r,i)=>{i.d(r,{W:()=>verifyToken,f:()=>signToken});var t=i(9344),n=i.n(t);let a=process.env.JWT_SECRET;if(!a)throw Error("JWT_SECRET is missing in environment variables");function signToken(e,r="7d"){let i={expiresIn:String(r)};return n().sign(e,a,i)}function verifyToken(e){return n().verify(e,a)}}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),i=r.X(0,[4222],()=>__webpack_exec__(3535));module.exports=i})();