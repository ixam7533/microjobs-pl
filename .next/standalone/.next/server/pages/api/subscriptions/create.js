"use strict";(()=>{var e={};e.id=7430,e.ids=[7430],e.modules={3524:e=>{e.exports=require("@prisma/client")},4802:e=>{e.exports=require("cookie")},9344:e=>{e.exports=require("jsonwebtoken")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5185:(e,t,r)=>{r.r(t),r.d(t,{config:()=>c,default:()=>l,routeModule:()=>p});var s={};r.r(s),r.d(s,{default:()=>handler});var a=r(1802),i=r(7153),n=r(6249),o=r(614),u=r(5613),d=r(5066);async function handler(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let r=null,s=await (0,o.getToken)({req:e,secret:process.env.NEXTAUTH_SECRET});if(s&&s.email&&(r={email:s.email}),!r){let t=await (0,u.A)(e);t&&(r=t)}if(!r)return t.status(401).json({error:"Not authenticated"});let{type:a}=e.body;if(!["PRO","PRO_PLUS"].includes(a))return t.status(400).json({error:"Invalid subscription type"});let i=await d.Z.user.findUnique({where:{email:r.email}});if(!i)return t.status(404).json({error:"User not found"});let n=new Date;if(i.subscriptionEnd&&i.subscriptionEnd>n)return t.status(400).json({error:"User already has active subscription"});let l=new Date,c=new Date;c.setMonth(c.getMonth()+1),await d.Z.subscription.create({data:{userId:i.id,type:a,status:"ACTIVE",startDate:l,endDate:c,autoRenew:!0}}),await d.Z.user.update({where:{email:r.email},data:{subscriptionType:a,subscriptionStart:l,subscriptionEnd:c,promotionsUsed:0,promotionsLimit:"PRO_PLUS"===a?-1:0}}),t.status(200).json({success:!0,message:`Subskrypcja ${a} zostaÅ‚a aktywowana`})}catch(e){console.error("Create subscription error:",e),t.status(500).json({error:"Internal server error"})}}let l=(0,n.l)(s,"default"),c=(0,n.l)(s,"config"),p=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/subscriptions/create",pathname:"/api/subscriptions/create",bundlePath:"",filename:""},userland:s})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222,5613],()=>__webpack_exec__(5185));module.exports=r})();