"use strict";(()=>{var e={};e.id=8782,e.ids=[8782],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5962:(e,o,a)=>{a.r(o),a.d(o,{config:()=>l,default:()=>t,routeModule:()=>d});var i={};a.r(i),a.d(i,{default:()=>handler});var r=a(1802),s=a(7153),n=a(6249),w=a(5066);let c={dolnośląskie:["Wrocław","Wałbrzych","Legnica","Jelenia G\xf3ra","Lubin","Głog\xf3w","Świdnica","Bolesławiec","Oleśnica","Dzierżoni\xf3w","Zgorzelec","Bielawa","Oława","Kłodzko","Środa Śląska","Trzebnica","Ząbkowice Śląskie","Jawor","Polkowice","G\xf3ra","Złotoryja","Nowa Ruda","Gryf\xf3w Śląski","Kąty Wrocławskie","Syc\xf3w","Strzelin","Milicz","Żmigr\xf3d","Lw\xf3wek Śląski"],"kujawsko-pomorskie":["Bydgoszcz","Toruń","Włocławek","Grudziądz","Inowrocław","Brodnica","Żnin","Świecie","Chełmno","Golub-Dobrzyń","Wąbrzeźno","Rypin","Lipno","Nakło nad Notecią","Tuchola","Koronowo","Solec Kujawski","Ciechocinek","Aleksandr\xf3w Kujawski","Kruszwica","Mogilno","Strzelno"],lubelskie:["Lublin","Chełm","Zamość","Biała Podlaska","Puławy","Świdnik","Kraśnik","Łuk\xf3w","Tomasz\xf3w Lubelski","Hrubiesz\xf3w","Łęczna","Dęblin","Parczew","Krasnystaw","Międzyrzec Podlaski","Radzyń Podlaski","Lubart\xf3w","Włodawa","Jan\xf3w Lubelski","Rejowiec Fabryczny","Kazimierz Dolny","Nałęcz\xf3w","Annopol","Opole Lubelskie","Poniatowa","Terespol"],lubuskie:["Gorz\xf3w Wielkopolski","Zielona G\xf3ra","Żary","Żagań","Nowa S\xf3l","Świebodzin","Sulech\xf3w","Międzyrzecz","Gubin\xf3w","Słubice","Kostrzyn nad Odrą","Krosno Odrzańskie","Szprotawa","Wschowa","Żukowo","Cybinka","Rzepin","Lubniewice","Strzelce Krajeńskie","Witnicy","Drezdenko","Sulęcin"],łódzkie:["Ł\xf3dź","Piotrk\xf3w Trybunalski","Pabianice","Tomasz\xf3w Mazowiecki","Bełchat\xf3w","Zgierz","Radomsko","Sieradz","Skierniewice","Kutno","Łask","Ozork\xf3w","Zduńska Wola","Wieluń","Pajęczno","Łowicz","Aleksandr\xf3w Ł\xf3dzki","Konstantyn\xf3w Ł\xf3dzki","Głowno","Brzeziny","Koluszki","Opoczno","Rawa Mazowiecka","Wierusz\xf3w","Poddębice","Łęczyca","Stryk\xf3w"],małopolskie:["Krak\xf3w","Tarn\xf3w","Nowy Sącz","Oświęcim","Chrzan\xf3w","Olkusz","Zakopane","Nowy Targ","Gorlice","Brzesko","Wadowice","Myślenice","Andrych\xf3w","Kęty","Skawina","Wieliczka","Niepołomice","Limanowa","Muszyna","Rabka-Zdr\xf3j","Sucha Beskidzka","Krynica-Zdr\xf3j","Jordan\xf3w","Bochnia","Dąbrowa Tarnowska","Brzeszcze","Kalwaria Zebrzydowska","Proszowice"],mazowieckie:["Warszawa","Radom","Płock","Siedlce","Pruszk\xf3w","Legionowo","Ostrołęka","Żyrard\xf3w","Ciechan\xf3w","Mińsk Mazowiecki","Otwock","Piaseczno","Grodzisk Mazowiecki","Wołomin","Marki","Ząbki","Kobyłka","Sulej\xf3wek","Milan\xf3wek","Piast\xf3w","Łomianki","Konstancin-Jeziorna","J\xf3zef\xf3w","Halin\xf3w","Wiązowna","Karczew","G\xf3ra Kalwaria","Tłuszcz","Serock","Nasielsk","Pułtusk","Mława","Mak\xf3w","Przasnysz","Żuromin","R\xf3żan","Wyszk\xf3w","Sokoł\xf3w Podlaski","Węgr\xf3w","Łosice","Garwolin","Pilawa","Kozienice","Zwoleń","Lipsko","Szydłowiec","Skarżysko-Kamienna","Starachowice","Ostrowiec Świętokrzyski"],opolskie:["Opole","Kędzierzyn-Koźle","Nysa","Kluczbork","Prudnik","Brzeg","Strzelce Opolskie","Krapkowice","Głubczyce","Zdziszowice","Lewin Brzeski","Niemodlin","Grodk\xf3w","Paczk\xf3w","Namysł\xf3w","Praszka","Zawadzkie","Gogolin","Ozimek","Babor\xf3w","Biała","Dobrodzień","Głog\xf3wek"],podkarpackie:["Rzesz\xf3w","Przemyśl","Stalowa Wola","Mielec","Tarnobrzeg","Krosno","Jarosław","Sanok","Jasło","Dębica","Łańcut","Ropczyce","Strzyż\xf3w","Brzoz\xf3w","Leżajsk","Przeworsk","Kolbuszowa","Nisko","Rudnik nad Sanem","Ustrzyki Dolne","Lubacz\xf3w","Ryman\xf3w","Iwonicz-Zdr\xf3j","Pilzno","Boguchwała"],podlaskie:["Białystok","Suwałki","Łomża","August\xf3w","Bielsk Podlaski","Grajewo","Zambr\xf3w","Hajn\xf3wka","Sok\xf3łka","Mońki","Wysokie Mazowieckie","Siemiatycze","Drohiczyn","Sejny","Krynki","Wasilk\xf3w","Czarna Białostocka","Suraż","Tykocin","Knyszyn","Jedwabne","Rajgr\xf3d","Stawiski","Bargł\xf3w Kościelny"],pomorskie:["Gdańsk","Gdynia","Sopot","Słupsk","Tczew","Starogard Gdański","Wejherowo","Rumia","Reda","Pruszcz Gdański","Żukowo","Kartuzy","Kościerzyna","Chojnice","Malbork","Sztum","Nowy Dw\xf3r Gdański","Puck","Hel","Władysławowo","Łeba","Ustka","Człuch\xf3w","Byt\xf3w","Lębork","Kwidzyń","Gniew","Sk\xf3rcz","Pszcz\xf3łki","Banino"],śląskie:["Katowice","Częstochowa","Sosnowiec","Gliwice","Zabrze","Bytom","Bielsko-Biała","Ruda Śląska","Rybnik","Tychy","Dąbrowa G\xf3rnicza","Chorz\xf3w","Jaworzno","Jastrzębie-Zdr\xf3j","Mysłowice","Siemianowice Śląskie","Żory","Świętochłowice","Piekary Śląskie","Będzin","Czeladź","Tarnowskie G\xf3ry","Racib\xf3rz","Wodzisław Śląski","Żywiec","Cieszyn","Ustroń","Wisła","Pszczyna","Mikoł\xf3w","Czerwionka-Leszczyny","Knur\xf3w","Łaziska G\xf3rne","Orzesze","Radlin","Rydułtowy","Wojkowice","Sławk\xf3w","Imielin","Lędziny","Bieruń","Czechowice-Dziedzice","Skocz\xf3w","Strumień"],świętokrzyskie:["Kielce","Ostrowiec Świętokrzyski","Starachowice","Skarżysko-Kamienna","Końskie","Busko-Zdr\xf3j","Jędrzej\xf3w","Pińcz\xf3w","Kazimierza Wielka","Sandomierz","Stasz\xf3w","Włoszczowa","Suchedni\xf3w","Działoszyce","Chmielnik","Kun\xf3w","Małogoszcz","Chęciny","Daleszyce","Bodzentyn","Połaniec","Koprzywnica","Klimont\xf3w","Opat\xf3w","Ożar\xf3w"],"warmińsko-mazurskie":["Olsztyn","Elbląg","Ełk","Ostr\xf3da","Iława","Giżycko","Kętrzyn","Szczytno","Mrągowo","Bartoszyce","Pisz","Lidzbark Warmiński","Węgorzewo","Gołdap","Braniewo","Nowe Miasto Lubawskie","Działdowo","Nidzica","Pasłęk","Orneta","G\xf3rowo Iławeckie","Frombork","Tolkmicko","Dobre Miasto","Jeziorany","Korsze","Reszel","Ryn","Mikołajki","Biała Piska"],wielkopolskie:["Poznań","Kalisz","Konin","Piła","Ostr\xf3w Wielkopolski","Gniezno","Leszno","Śrem","Września","Turek","Krotoszyn","Jarocin","Pleszew","Kościan","Środa Wielkopolska","Swarzędz","Luboń","Mosina","Puszczykowo","Czerwonak","Murowana Goślina","Kostrzyn","Pobiedziska","K\xf3rnik","Tarnowo Podg\xf3rne","Dopiewo","Rokietnica","Stęszew","Buk","Grodzisk Wielkopolski","Opalenica","Nowy Tomyśl","Wolsztyn","Zbąszynek","Trzcianka","Chodzież","Wągrowiec","Rogoźno","Obrzycko","Szamotuły","Pniewy","Lw\xf3wek"],zachodniopomorskie:["Szczecin","Koszalin","Stargard","Świnoujście","Wałcz","Kołobrzeg","Szczecinek","Białogard","Gryfino","Goleni\xf3w","Pyrzyce","Myślib\xf3rz","Dębno","Choszczno","Łobez","Drawsko Pomorskie","Świdwin","Połczyn-Zdr\xf3j","Złocieniec","Borne Sulinowo","Sławno","Darłowo","Miastko","Trzebiat\xf3w","Rewal","Międzyzdroje","Kamień Pomorski","Wolin","Dziwn\xf3w","Nowogard","Gryfice","Płoty"]},k={Warszawa:["Warzenko","Wawa","Stołeczne","Mazowieckie","Warsaw"],Kraków:["Cracow","Krakow","Małopolskie"],Gdańsk:["Trojmiasto","Tr\xf3jmiasto","Pomorskie"],Wrocław:["Dolnośląskie","Wroclaw"],Poznań:["Poznan","Wielkopolskie"],Łódź:["Lodz","Ł\xf3dzkie"],Katowice:["Śląskie","Slask","Śląsk","Katowice Śląskie"],Lublin:["Lubelskie"],Białystok:["Podlaskie"],Szczecin:["Zachodniopomorskie"],Bydgoszcz:["Kujawsko-Pomorskie"],Olsztyn:["Warmińsko-Mazurskie"],Rzeszów:["Podkarpackie"],Kielce:["Świętokrzyskie"],"Gorz\xf3w Wielkopolski":["Lubuskie"],Opole:["Opolskie"]},z={Warzenko:["Warszawa"],Kato:["Katowice"],Krakus:["Krak\xf3w"],Trojmiasto:["Gdańsk","Gdynia","Sopot"],Slask:["Katowice","Zabrze","Gliwice","Bytom"],Stolica:["Warszawa"]};async function handler(e,o){if("GET"===e.method){let a=new Date;await w.Z.offer.updateMany({where:{promoted:!0,promotedUntil:{lt:a}},data:{promoted:!1,promotedUntil:null}});let{maxPrice:i,minPrice:r,province:s,city:n,radius:t,mainCat:l,subCat:d,sortBy:f,search:u,offerType:y,page:x="1",limit:m="12"}=e.query,p=parseInt(x),b=parseInt(m),K={};if((i||r)&&(K.price={},i&&(K.price.lte=parseInt(i)),r&&(K.price.gte=parseInt(r))),l&&(K.category=l),y&&(K.offerType=y),s||n){let e=[];if(s&&!n){e.push({location:{contains:s}});let o=c[s]||[];o.forEach(o=>{e.push({location:{contains:o}});let a=k[o]||[];a.forEach(o=>{e.push({location:{contains:o}})})})}else if(n&&!s){let o=function(e){let o=e.toLowerCase(),a=[];for(let[i,r]of(a.push(e),Object.entries(z)))i.toLowerCase()===o&&a.push(...r);for(let[e,i]of Object.entries(k))e.toLowerCase()===o&&a.push(...i),i.some(e=>e.toLowerCase()===o)&&a.push(e);return[...new Set(a)]}(n);o.forEach(o=>{e.push({location:{contains:o}})})}else if(s&&n){let o=c[s]||[],a=function(e){let o=e.toLowerCase();for(let[e,a]of Object.entries(k))if(e.toLowerCase()===o||a.some(e=>e.toLowerCase()===o))return e;return e}(n),i=n.toLowerCase(),r=o.some(e=>e.toLowerCase().includes(i)||e.toLowerCase()===a.toLowerCase());r&&(e.push({location:{contains:n}}),a!==n&&e.push({location:{contains:a}}))}e.length>0&&(K.OR=e)}if(u){let e=[{title:{contains:u}},{description:{contains:u}}];K.OR?(K.AND=[{OR:K.OR},{OR:e}],delete K.OR):K.OR=e}let P=[{promoted:"desc"},{createdAt:"desc"}];if(f)switch(f){case"newest":default:P=[{promoted:"desc"},{createdAt:"desc"}];break;case"oldest":P=[{promoted:"desc"},{createdAt:"asc"}];break;case"price_low":P=[{promoted:"desc"},{price:"asc"}];break;case"price_high":P=[{promoted:"desc"},{price:"desc"}];break;case"title":P=[{promoted:"desc"},{title:"asc"}]}let[S,h]=await Promise.all([w.Z.offer.findMany({where:K,orderBy:P,skip:(p-1)*b,take:b,include:{images:{orderBy:{id:"asc"}},owner:{select:{id:!0,email:!0,name:!0}}}}),w.Z.offer.count({where:K})]),g=S.map(e=>({...e,ownerEmail:e.owner.email,ownerName:e.owner.name,image:e.images.length>0?e.images[0].url:"/house4k.jpg",images:e.images.map(e=>e.url),isPromoted:e.promoted&&e.promotedUntil&&e.promotedUntil>a})),W=Math.ceil(h/b);return o.status(200).json({offers:g,pagination:{currentPage:p,totalPages:W,totalCount:h,itemsPerPage:b,hasNextPage:p<W,hasPrevPage:p>1}})}return o.setHeader("Allow",["GET"]),o.status(405).end()}let t=(0,n.l)(i,"default"),l=(0,n.l)(i,"config"),d=new r.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/offers",pathname:"/api/offers",bundlePath:"",filename:""},userland:i})},5066:(e,o,a)=>{a.d(o,{Z:()=>s});var i=a(3524);let r=new i.PrismaClient,s=r}};var o=require("../../webpack-api-runtime.js");o.C(e);var __webpack_exec__=e=>o(o.s=e),a=o.X(0,[4222],()=>__webpack_exec__(5962));module.exports=a})();