"use strict";(()=>{var e={};e.id=5631,e.ids=[5631],e.modules={3524:e=>{e.exports=require("@prisma/client")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6594:(e,t,a)=>{a.r(t),a.d(t,{config:()=>l,default:()=>d,routeModule:()=>p});var r={};a.r(r),a.d(r,{default:()=>handler});var s=a(1802),i=a(7153),n=a(6249),o=a(614),u=a(5066);async function handler(e,t){if("POST"!==e.method)return t.status(405).json({error:"Metoda niedozwolona"});try{let a=await (0,o.getToken)({req:e});if(!a?.email)return t.status(401).json({error:"Musisz być zalogowany"});let{subscriptionType:r}=e.body;if(!r||!["PRO","PRO_PLUS"].includes(r))return t.status(400).json({error:"Nieprawidłowy typ subskrypcji"});let s=await u.Z.user.findUnique({where:{email:a.email}});if(!s)return t.status(404).json({error:"Użytkownik nie znaleziony"});let i=new Date;i.setDate(i.getDate()+30),await u.Z.user.update({where:{id:s.id},data:{subscriptionType:r,subscriptionStart:new Date,subscriptionEnd:i}});let n=await u.Z.subscription.create({data:{userId:s.id,type:r,status:"ACTIVE",startDate:new Date,endDate:i,autoRenew:!0}});return t.status(200).json({message:"Subskrypcja została aktywowana",subscription:{type:r,start:n.startDate,end:n.endDate,autoRenew:n.autoRenew}})}catch(e){return console.error("Błąd podczas tworzenia subskrypcji:",e),t.status(500).json({error:"Błąd serwera"})}}let d=(0,n.l)(r,"default"),l=(0,n.l)(r,"config"),p=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/subscription/create",pathname:"/api/subscription/create",bundlePath:"",filename:""},userland:r})},5066:(e,t,a)=>{a.d(t,{Z:()=>i});var r=a(3524);let s=new r.PrismaClient,i=s}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222],()=>__webpack_exec__(6594));module.exports=a})();