"use strict";(()=>{var e={};e.id=4489,e.ids=[4489],e.modules={3524:e=>{e.exports=require("@prisma/client")},4802:e=>{e.exports=require("cookie")},9344:e=>{e.exports=require("jsonwebtoken")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},29:(e,r,t)=>{t.r(r),t.d(r,{config:()=>u,default:()=>f,routeModule:()=>c});var o={};t.r(o),t.d(o,{default:()=>handler});var a=t(1802),i=t(7153),s=t(6249),n=t(5066),d=t(5613);async function handler(e,r){let t=await (0,d.A)(e);if(!t)return r.status(401).json({error:"Zaloguj się"});if("GET"===e.method)try{let e=await n.Z.favorite.findMany({where:{userId:t.id},include:{offer:{include:{images:!0,owner:!0}}},orderBy:{createdAt:"desc"}});r.json(e.map(e=>({id:e.offer.id,title:e.offer.title,category:e.offer.category,description:e.offer.description,location:e.offer.location,contactName:e.offer.contactName,contactEmail:e.offer.contactEmail,contactPhone:e.offer.contactPhone,ownerEmail:e.offer.owner.email,createdAt:e.offer.createdAt,image:e.offer.images[0]?.url||"/house4k.jpg",images:e.offer.images.map(e=>e.url),price:e.offer.price||0,favoriteId:e.id})))}catch(e){console.error("Błąd pobierania ulubionych:",e),r.status(500).json({error:"Błąd serwera"})}if("POST"===e.method)try{let{offerId:o}=e.body;if(!o)return r.status(400).json({error:"Brak ID ogłoszenia"});let a=await n.Z.favorite.findUnique({where:{userId_offerId:{userId:t.id,offerId:parseInt(o)}}});if(a)return r.status(400).json({error:"Już w ulubionych"});let i=await n.Z.favorite.create({data:{userId:t.id,offerId:parseInt(o)}});await n.Z.$executeRaw`
        UPDATE Offer 
        SET likes = likes + 1 
        WHERE id = ${parseInt(o)}
      `,r.status(201).json({success:!0,favorite:i})}catch(e){console.error("Błąd dodawania do ulubionych:",e),r.status(500).json({error:"Błąd serwera"})}if("DELETE"===e.method)try{let{offerId:o}=e.body;if(!o)return r.status(400).json({error:"Brak ID ogłoszenia"});await n.Z.favorite.delete({where:{userId_offerId:{userId:t.id,offerId:parseInt(o)}}}),await n.Z.$executeRaw`
        UPDATE Offer 
        SET likes = likes - 1 
        WHERE id = ${parseInt(o)} AND likes > 0
      `,r.json({success:!0})}catch(e){console.error("Błąd usuwania z ulubionych:",e),r.status(500).json({error:"Błąd serwera"})}r.status(405).json({error:"Metoda nie dozwolona"})}let f=(0,s.l)(o,"default"),u=(0,s.l)(o,"config"),c=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/auth/favorites",pathname:"/api/auth/favorites",bundlePath:"",filename:""},userland:o})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[4222,5613],()=>__webpack_exec__(29));module.exports=t})();