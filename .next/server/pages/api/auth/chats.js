"use strict";(()=>{var e={};e.id=4e3,e.ids=[4e3],e.modules={3524:e=>{e.exports=require("@prisma/client")},4802:e=>{e.exports=require("cookie")},9344:e=>{e.exports=require("jsonwebtoken")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2777:(e,t,a)=>{a.r(t),a.d(t,{config:()=>c,default:()=>l,routeModule:()=>d});var r={};a.r(r),a.d(r,{default:()=>handler});var s=a(1802),i=a(7153),n=a(6249),u=a(5066),o=a(5613);async function handler(e,t){let a=await (0,o.A)(e);if(!a)return t.status(401).json({error:"Unauthorized"});let r=await u.Z.user.findUnique({where:{email:a.email},include:{chatParticipants:{include:{chat:{include:{participants:{include:{user:!0}},messages:{orderBy:{createdAt:"desc"},take:1}}}}}}});if(console.log("\uD83D\uDCAC Chat API - userAuth:",a.email),console.log("\uD83D\uDCAC Chat API - user found:",!!r),!r)return console.error("\uD83D\uDCAC Chat API - User not found in database:",a.email),t.status(404).json({error:"User not found"});let s=r.chatParticipants.map(e=>{let t=e.chat.participants.find(e=>e.user.email!==a.email),r=e.chat.messages[0];return{chatId:e.chat.id,withUser:t.user.email,lastMessage:r?.content??null,lastAt:r?.createdAt??null}});t.status(200).json(s)}let l=(0,n.l)(r,"default"),c=(0,n.l)(r,"config"),d=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/auth/chats",pathname:"/api/auth/chats",bundlePath:"",filename:""},userland:r})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222,5613],()=>__webpack_exec__(2777));module.exports=a})();