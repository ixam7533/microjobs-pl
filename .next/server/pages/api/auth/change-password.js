"use strict";(()=>{var e={};e.id=439,e.ids=[439],e.modules={3524:e=>{e.exports=require("@prisma/client")},7096:e=>{e.exports=require("bcrypt")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4848:(e,a,s)=>{s.r(a),s.d(a,{config:()=>p,default:()=>m,routeModule:()=>h});var t={};s.r(t),s.d(t,{default:()=>handler});var n=s(1802),r=s(7153),i=s(6249),o=s(7096),u=s.n(o),l=s(5066),d=s(298);async function handler(e,a){if("POST"!==e.method)return a.status(405).json({message:"Method not allowed"});try{let s=e.headers.authorization?.replace("Bearer ","")||e.cookies.token;if(!s)return a.status(401).json({message:"Nie jesteś zalogowany"});let t=(0,d.W)(s);if(!t)return a.status(401).json({message:"Nieprawidłowy token"});let{currentPassword:n,newPassword:r}=e.body;if(!n||!r)return a.status(400).json({message:"Wszystkie pola są wymagane"});if(r.length<6)return a.status(400).json({message:"Nowe hasło musi mieć co najmniej 6 znak\xf3w"});let i=await l.Z.user.findUnique({where:{email:t.email}});if(!i||!i.hash)return a.status(404).json({message:"Użytkownik nie znaleziony lub brak hasła"});let o=await u().compare(n,i.hash);if(!o)return a.status(400).json({message:"Obecne hasło jest nieprawidłowe"});let m=await u().hash(r,12);await l.Z.user.update({where:{email:t.email},data:{hash:m}}),a.status(200).json({message:"Hasło zostało zmienione pomyślnie"})}catch(e){console.error("Błąd zmiany hasła:",e),a.status(500).json({message:"Wewnętrzny błąd serwera"})}}let m=(0,i.l)(t,"default"),p=(0,i.l)(t,"config"),h=new n.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/auth/change-password",pathname:"/api/auth/change-password",bundlePath:"",filename:""},userland:t})},298:(e,a,s)=>{s.d(a,{W:()=>verifyToken,f:()=>signToken});var t=s(9344),n=s.n(t);let r=process.env.JWT_SECRET;if(!r)throw Error("JWT_SECRET is missing in environment variables");function signToken(e,a="7d"){let s={expiresIn:String(a)};return n().sign(e,r,s)}function verifyToken(e){return n().verify(e,r)}},5066:(e,a,s)=>{s.d(a,{Z:()=>r});var t=s(3524);let n=new t.PrismaClient,r=n}};var a=require("../../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),s=a.X(0,[4222],()=>__webpack_exec__(4848));module.exports=s})();