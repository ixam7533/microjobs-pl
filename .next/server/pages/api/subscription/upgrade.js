"use strict";(()=>{var e={};e.id=6945,e.ids=[6945],e.modules={3524:e=>{e.exports=require("@prisma/client")},614:e=>{e.exports=require("next-auth/jwt")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4599:(e,t,r)=>{r.r(t),r.d(t,{config:()=>p,default:()=>d,routeModule:()=>l});var a={};r.r(a),r.d(a,{default:()=>handler});var s=r(1802),i=r(7153),n=r(6249),u=r(614),o=r(5066);async function handler(e,t){if("POST"!==e.method)return t.status(405).json({error:"Metoda niedozwolona"});try{let r=await (0,u.getToken)({req:e});if(!r?.email)return t.status(401).json({error:"Musisz być zalogowany"});let a=await o.Z.user.findUnique({where:{email:r.email},include:{subscriptions:{where:{status:"ACTIVE"},orderBy:{createdAt:"desc"},take:1}}});if(!a)return t.status(404).json({error:"Użytkownik nie znaleziony"});if(!a.subscriptions.length||"PRO"!==a.subscriptionType)return t.status(400).json({error:"Brak aktywnej subskrypcji PRO"});let s=a.subscriptions[0];await o.Z.user.update({where:{id:a.id},data:{subscriptionType:"PRO_PLUS"}});let i=await o.Z.subscription.update({where:{id:s.id},data:{type:"PRO_PLUS"}});return t.status(200).json({message:"Subskrypcja została zaktualizowana do PRO+",subscription:{type:"PRO_PLUS",start:i.startDate,end:i.endDate,autoRenew:i.autoRenew}})}catch(e){return console.error("Błąd podczas aktualizacji subskrypcji:",e),t.status(500).json({error:"Błąd serwera"})}}let d=(0,n.l)(a,"default"),p=(0,n.l)(a,"config"),l=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/subscription/upgrade",pathname:"/api/subscription/upgrade",bundlePath:"",filename:""},userland:a})},5066:(e,t,r)=>{r.d(t,{Z:()=>i});var a=r(3524);let s=new a.PrismaClient,i=s}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222],()=>__webpack_exec__(4599));module.exports=r})();