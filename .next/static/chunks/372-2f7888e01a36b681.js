(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[372],{3130:function(e,t,n){"use strict";n.d(t,{Z:function(){return AdminSubscriptionPanel}});var a=n(5893),i=n(7294),s=n(9989),o=n.n(s);function AdminSubscriptionPanel(e){let{isVisible:t,onClose:n}=e,[s,r]=(0,i.useState)([]),[c,l]=(0,i.useState)(!1),[u,d]=(0,i.useState)(""),[m,p]=(0,i.useState)("PRO"),[h,_]=(0,i.useState)(30),[g,b]=(0,i.useState)("");(0,i.useEffect)(()=>{t&&fetchUsers()},[t]);let fetchUsers=async()=>{l(!0);try{let e=await fetch("/api/admin/users");if(e.ok){let t=await e.json();r(t.users)}}catch(e){console.error("Error fetching users:",e)}l(!1)},handleGrantSubscription=async()=>{if(!u){b("Wybierz użytkownika");return}l(!0);try{let e=await fetch("/api/admin/manage-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userEmail:u,subscriptionType:m,duration:h})}),t=await e.json();e.ok?(b("✅ Pomyślnie nadano ".concat(m," dla ").concat(u)),fetchUsers(),d("")):b("❌ Błąd: ".concat(t.error))}catch(e){b("❌ Błąd podczas nadawania subskrypcji")}l(!1)},getSubscriptionColor=e=>{switch(e){case"PRO":return"#4CAF50";case"PRO_PLUS":return"#FF9800";default:return"#9E9E9E"}},getStatusColor=e=>e?"#4CAF50":"#F44336";return t?(0,a.jsx)("div",{className:o().overlay,children:(0,a.jsxs)("div",{className:o().panel,children:[(0,a.jsxs)("div",{className:o().header,children:[(0,a.jsx)("h2",{children:"\uD83D\uDC51 Panel Administracyjny - Zarządzanie Subskrypcjami"}),(0,a.jsx)("button",{className:o().closeButton,onClick:n,children:"✕"})]}),(0,a.jsxs)("div",{className:o().content,children:[(0,a.jsxs)("div",{className:o().grantSection,children:[(0,a.jsx)("h3",{children:"Nadaj Subskrypcję"}),(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsx)("label",{children:"Wybierz użytkownika:"}),(0,a.jsxs)("select",{value:u,onChange:e=>d(e.target.value),className:o().select,children:[(0,a.jsx)("option",{value:"",children:"-- Wybierz użytkownika --"}),s.map(e=>(0,a.jsxs)("option",{value:e.email,children:[e.email," (",e.name||"Bez nazwy",") - ",e.subscriptionType]},e.id))]})]}),(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsx)("label",{children:"Typ subskrypcji:"}),(0,a.jsxs)("select",{value:m,onChange:e=>p(e.target.value),className:o().select,children:[(0,a.jsx)("option",{value:"FREE",children:"FREE"}),(0,a.jsx)("option",{value:"PRO",children:"PRO"}),(0,a.jsx)("option",{value:"PRO_PLUS",children:"PRO+"})]})]}),(0,a.jsxs)("div",{className:o().formGroup,children:[(0,a.jsx)("label",{children:"Czas trwania (dni):"}),(0,a.jsx)("input",{type:"number",value:h,onChange:e=>_(parseInt(e.target.value)),min:"1",max:"365",className:o().input})]}),(0,a.jsx)("button",{onClick:handleGrantSubscription,disabled:c,className:o().grantButton,children:c?"Przetwarzanie...":"Nadaj Subskrypcję"}),g&&(0,a.jsx)("div",{className:o().message,children:g})]}),(0,a.jsxs)("div",{className:o().usersSection,children:[(0,a.jsxs)("h3",{children:["Lista Użytkownik\xf3w (",s.length,")"]}),(0,a.jsx)("div",{className:o().usersList,children:s.map(e=>(0,a.jsxs)("div",{className:o().userCard,children:[(0,a.jsxs)("div",{className:o().userInfo,children:[(0,a.jsxs)("div",{className:o().userEmail,children:[e.email," ",e.isAdmin&&"\uD83D\uDC51"]}),(0,a.jsx)("div",{className:o().userName,children:e.name||"Bez nazwy"})]}),(0,a.jsxs)("div",{className:o().subscriptionInfo,children:[(0,a.jsx)("span",{className:o().subscriptionType,style:{backgroundColor:getSubscriptionColor(e.subscriptionType)},children:e.subscriptionType}),(0,a.jsx)("span",{className:o().status,style:{color:getStatusColor(e.isSubscriptionActive)},children:e.isSubscriptionActive?"Aktywna":"Nieaktywna"}),null!==e.daysRemaining&&(0,a.jsxs)("span",{className:o().daysRemaining,children:[e.daysRemaining," dni"]})]}),(0,a.jsxs)("div",{className:o().usageInfo,children:[(0,a.jsxs)("small",{children:["Promocje użyte: ",e.promotionsUsed]}),(0,a.jsxs)("small",{children:["Dołączył: ",new Date(e.createdAt).toLocaleDateString("pl-PL")]})]})]},e.id))})]})]})]})}):null}},1372:function(e,t,n){"use strict";n.d(t,{Z:function(){return Header}});var a=n(5893),i=n(7294),s=n(1163),o=n(1664),r=n.n(o),c=n(3299),l=n(4079),u=n.n(l),d=n(5379),m=n.n(d),p=n(6459),h=n(5040),_=n(3504);function ThemeSwitch(){let[e,t]=(0,i.useState)("natura");return(0,i.useEffect)(()=>{let e=localStorage.getItem("theme");window.matchMedia("(prefers-color-scheme: dark)").matches;let n=e||"natura";t(n),document.documentElement.setAttribute("data-theme",n)},[]),(0,a.jsxs)("button",{onClick:()=>{let n=["natura","dark","light","night"],a=n.indexOf(e),i=n[(a+1)%n.length];t(i),document.documentElement.setAttribute("data-theme",i),localStorage.setItem("theme",i)},className:"jsx-3c8afe78bed0d352 theme-button",children:[(()=>{switch(e){case"dark":default:return(0,a.jsx)(p.Z,{className:"icon"});case"light":return(0,a.jsx)(h.Z,{className:"icon"});case"night":return(0,a.jsx)(_.Z,{className:"icon"});case"natura":return(0,a.jsx)("span",{className:"icon",children:"\uD83C\uDF3F"})}})(),(0,a.jsx)("span",{className:"jsx-3c8afe78bed0d352 theme-label",children:e}),(0,a.jsx)(m(),{id:"3c8afe78bed0d352",children:".theme-button.jsx-3c8afe78bed0d352{display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;gap:8px;padding:8px 12px;background:var(--bg-color);border:2px solid var(--text-color);-webkit-border-radius:20px;-moz-border-radius:20px;border-radius:20px;cursor:pointer;-webkit-transition:all.3s ease;-moz-transition:all.3s ease;-o-transition:all.3s ease;transition:all.3s ease;color:var(--text-color);font-size:12px;font-weight:500;text-transform:uppercase}.theme-button.jsx-3c8afe78bed0d352:hover{background:var(--text-color);color:var(--bg-color)}.icon.jsx-3c8afe78bed0d352{width:16px;height:16px;color:currentColor}.theme-label.jsx-3c8afe78bed0d352{font-size:11px;letter-spacing:.5px}"})]})}var g=n(4585),b=n.n(g);function PromotionCounter(e){let{className:t}=e,[n,s]=(0,i.useState)(null);(0,i.useEffect)(()=>{fetchPromotionData();let e=setInterval(fetchPromotionData,3e4);return()=>clearInterval(e)},[]);let fetchPromotionData=async()=>{try{console.log("\uD83D\uDD04 PromotionCounter: Fetching data...");let e=new Date().getTime(),t=await fetch("/api/subscriptions/status?t=".concat(e),{credentials:"include"});if(console.log("\uD83D\uDCE1 PromotionCounter: Response status:",t.status),t.ok){let e=await t.json();console.log("\uD83D\uDCCA PromotionCounter: Received raw data:",JSON.stringify(e,null,2));try{if(e&&e.subscription&&e.subscription.isActive){console.log("✅ PromotionCounter: Setting active subscription data");let t={promotionsUsed:Number(e.subscription.promotionsUsed)||0,promotionsLimit:Number(e.subscription.promotionsLimit)||0,subscriptionType:e.subscription.type||null};console.log("\uD83C\uDFAF PromotionCounter: Setting state to:",t),s(t)}else console.log("❌ PromotionCounter: No active subscription")}catch(e){console.error("Error parsing subscription data:",e)}}else console.log("❌ PromotionCounter: Response not ok:",t.status)}catch(e){console.error("❌ PromotionCounter: Error fetching promotion data:",e)}};if(!n)return console.log("⏳ PromotionCounter: No promotion data yet"),null;let o="PRO_PLUS"===n.subscriptionType,r=o?3:n.promotionsLimit||0,c=n.promotionsUsed||0,l=Math.max(0,r-c);console.log("\uD83C\uDFAF PromotionCounter: Rendering with data:",{remaining:l,limit:r,isProPlus:o,type:n.subscriptionType});let u=Number.isFinite(l)?l.toString():"0",d=Number.isFinite(r)?r.toString():"0";return(0,a.jsx)("div",{className:"".concat(b().promotionCounter," ").concat(t||""),children:(0,a.jsxs)("div",{className:b().miniCounter,children:[(0,a.jsx)("span",{className:b().miniIcon,children:"\uD83C\uDFAF"}),(0,a.jsx)("span",{className:b().miniText,children:"".concat(u,"/").concat(d)})]})})}var x=n(7167),j=n.n(x);function ChatNotificationBadge(e){let{children:t}=e,[n,s]=(0,i.useState)(0);return(0,i.useEffect)(()=>{let fetchUnreadCount=async()=>{try{console.log("\uD83D\uDCAC ChatNotificationBadge: Fetching unread count...");let e=await fetch("/api/messages/unread-count",{credentials:"include"});if(console.log("\uD83D\uDCAC ChatNotificationBadge: Response status:",e.status),e.ok){let t=await e.json();console.log("\uD83D\uDCAC ChatNotificationBadge: Received data:",t),s(t.unreadCount)}else{let t=await e.json();console.log("\uD83D\uDCAC ChatNotificationBadge: Error response:",t)}}catch(e){console.error("\uD83D\uDCAC ChatNotificationBadge: Error fetching unread count:",e)}};fetchUnreadCount();let e=setInterval(fetchUnreadCount,3e4);return()=>clearInterval(e)},[]),(0,a.jsxs)("div",{className:j().notificationWrapper,children:[t,n>0&&(0,a.jsx)("span",{className:j().badge,children:n>99?"99+":n})]})}var f=n(3130);function Header(){let[e,t]=(0,i.useState)(null),[n,o]=(0,i.useState)("dark"),[l,d]=(0,i.useState)(!1),m=(0,s.useRouter)();(0,i.useEffect)(()=>{fetch("/api/auth/me").then(async e=>{if(!e.ok)return null;try{return await e.json()}catch(e){return console.error("Invalid JSON from /api/auth/me"),null}}).then(e=>{(null==e?void 0:e.user)&&t(e.user)}).catch(e=>console.error("Network error on /api/auth/me:",e));let e=new MutationObserver(()=>{let e=document.documentElement.getAttribute("data-theme")||"dark";o(e)});e.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]});let n=document.documentElement.getAttribute("data-theme")||"dark";return o(n),()=>e.disconnect()},[]);let handleLogout=async()=>{try{let e=await fetch("/api/auth/logout",{method:"POST"});e.ok?t(null):console.error("JWT Logout failed:",e.status),await (0,c.signOut)({redirect:!1}),m.replace("/")}catch(e){console.error("Network error on logout:",e)}};return(0,a.jsxs)("header",{className:u().header,"data-header":"true",children:[(0,a.jsxs)("div",{className:u().overlay,children:[(()=>{switch(n){case"light":return(0,a.jsx)("div",{className:u().lightBackground});case"dark":default:return(0,a.jsx)("video",{autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:u().video,children:(0,a.jsx)("source",{src:"/smoke.mp4",type:"video/mp4"})});case"night":return(0,a.jsx)("div",{className:u().nightBackground})}})(),(0,a.jsx)("div",{className:u().tint})]}),(0,a.jsxs)("div",{className:u().top,children:[(0,a.jsx)(ThemeSwitch,{}),(0,a.jsx)(r(),{href:"/",className:u().logo,children:(0,a.jsx)("span",{children:"MicroJobs"})}),(0,a.jsxs)("nav",{className:u().nav,children:[(0,a.jsxs)("div",{className:u().proSection,children:[(0,a.jsx)(r(),{href:"/pro",className:u().proBtn,children:"⭐ PRO"}),e&&(0,a.jsx)(PromotionCounter,{})]}),e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r(),{href:"/add-new",className:u().btn,children:"Dodaj ogłoszenie"}),(e.isAdmin||"microjobsj7@gmail.com"===e.email)&&(0,a.jsx)("button",{onClick:()=>d(!0),className:"".concat(u().btn," ").concat(u().adminBtn),title:"Panel Administratora",children:"\uD83D\uDC51 Admin"}),(0,a.jsx)(ChatNotificationBadge,{children:(0,a.jsx)(r(),{href:"/profile",className:u().btn,children:"M\xf3j profil"})}),(0,a.jsxs)("div",{className:u().userMenu,children:[(0,a.jsx)("span",{className:u().email,children:e.email}),(0,a.jsx)("button",{onClick:handleLogout,className:u().btn,children:"Wyloguj"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r(),{href:"/login",className:u().btn,children:"Logowanie"}),(0,a.jsx)(r(),{href:"/register",className:u().btn,children:"Rejestracja"})]})]})]}),(0,a.jsxs)("div",{className:u().hero,children:[(0,a.jsx)("h1",{children:"Zarabiaj w wolnej chwili"}),(0,a.jsx)("p",{children:"Prosto, lokalnie, efektywnie — szukaj i oferuj pracę."})]}),(0,a.jsx)("div",{className:u().wave,children:(0,a.jsx)("svg",{viewBox:"0 0 1440 40",preserveAspectRatio:"none",children:(0,a.jsx)("path",{d:"M0,20 C120,40 240,0 360,20 C480,40 600,0 720,20 C840,40 960,0 1080,20 C1200,40 1320,0 1440,20 L1440,40 L0,40 Z",fill:"var(--color-gray)"})})}),(0,a.jsx)(f.Z,{isVisible:l,onClose:()=>d(!1)})]})}},9989:function(e){e.exports={overlay:"AdminSubscriptionPanel_overlay__C8IB_",panel:"AdminSubscriptionPanel_panel__rKnSY",header:"AdminSubscriptionPanel_header__BGC9a",closeButton:"AdminSubscriptionPanel_closeButton__tQpDH",content:"AdminSubscriptionPanel_content__zAgX8",grantSection:"AdminSubscriptionPanel_grantSection__6N4zf",formGroup:"AdminSubscriptionPanel_formGroup__Cq0ee",select:"AdminSubscriptionPanel_select__N9pv4",input:"AdminSubscriptionPanel_input__wMapi",grantButton:"AdminSubscriptionPanel_grantButton__hIu_9",message:"AdminSubscriptionPanel_message__5_tku",usersSection:"AdminSubscriptionPanel_usersSection__WtdSK",usersList:"AdminSubscriptionPanel_usersList__zMvKy",userCard:"AdminSubscriptionPanel_userCard__b1Gje",userInfo:"AdminSubscriptionPanel_userInfo__cSik_",userEmail:"AdminSubscriptionPanel_userEmail__3uJDN",userName:"AdminSubscriptionPanel_userName__uz70B",subscriptionInfo:"AdminSubscriptionPanel_subscriptionInfo__FSu7B",subscriptionType:"AdminSubscriptionPanel_subscriptionType__vf8Ge",status:"AdminSubscriptionPanel_status__MQ_Ac",daysRemaining:"AdminSubscriptionPanel_daysRemaining__mA6gz",usageInfo:"AdminSubscriptionPanel_usageInfo__wBNi9"}},4079:function(e){e.exports={header:"Header_header__KwdYD",inner:"Header_inner__DLT3k",switch:"Header_switch__YAo6v",overlay:"Header_overlay__QkI_s",video:"Header_video__gpAzI",nightBackground:"Header_nightBackground__AtIcU",nightGradient:"Header_nightGradient__1XFaj",lightBackground:"Header_lightBackground___GEX2",lightGradient:"Header_lightGradient__9PbKz",tint:"Header_tint__p7TRw",top:"Header_top__ELEid",logo:"Header_logo____uDV",nav:"Header_nav__tNWGY",proSection:"Header_proSection__zsRPC",btn:"Header_btn__RDhAL",adminBtn:"Header_adminBtn__dDudE",proBtn:"Header_proBtn__o3iy_",userMenu:"Header_userMenu__B7S15",email:"Header_email__i4cac",hero:"Header_hero__DunNT",wave:"Header_wave__9DzMa"}},7167:function(e){e.exports={notificationWrapper:"NotificationBadge_notificationWrapper__ufdpL",badge:"NotificationBadge_badge__vK5Yf",pulse:"NotificationBadge_pulse__rJDPG"}},4585:function(e){e.exports={promotionCounter:"PromotionCounter_promotionCounter__Qej9E",miniCounter:"PromotionCounter_miniCounter__s_qZ4",miniIcon:"PromotionCounter_miniIcon__tqN6q",miniText:"PromotionCounter_miniText___ZNF4",counterBadge:"PromotionCounter_counterBadge__AyMnt",counterIcon:"PromotionCounter_counterIcon___myaK",counterText:"PromotionCounter_counterText__Ee6LE",counterLabel:"PromotionCounter_counterLabel__1nXHL",subscriptionBadge:"PromotionCounter_subscriptionBadge__qliiY",pulse:"PromotionCounter_pulse__GukTU"}}}]);